<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>瑪奇轉蛋機20251113 </title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, "Noto Sans TC", Arial, sans-serif; line-height: 1.5; }
    .topbar { display:flex; gap:.75rem; align-items:center; flex-wrap:wrap; margin:.5rem 0 1rem; }
    select, input[type="number"], input[type="text"] { padding:.35rem .5rem; border:1px solid #e5e7eb; border-radius:.4rem; }
    button { padding:.5rem .8rem; border:0; border-radius:.5rem; cursor:pointer; box-shadow:0 1px 3px rgba(0,0,0,.1); }
    button.primary { background:#2563eb; color:#fff; }
    button.warn { background:#ef4444; color:#fff; }
    button.ghost { background:#eee; }
    button.toggle { background:#f3f4f6; }
    button.toggle.active { outline:2px solid #2563eb; background:#dbeafe; }
    .badge { display:inline-block; min-width:1.8rem; text-align:center; font-weight:700; border-radius:.4rem; padding:0 .35rem; color:#111; }
    .lvS { background:#ffcdd2; border:1px solid #ef9a9a; }
    .lvA { background:#ffe9b3; border:1px solid #ffd166; }
    .lvB { background:#cfe8ff; border:1px solid #9ecbff; }
    .lvC { background:#e5e7eb; border:1px solid #d1d5db; }
    .count { font-variant-numeric:tabular-nums; border:1px solid #e5e7eb; border-radius:.4rem; padding:0 .35rem; }
    .count.lvS { background:#ffe4e6; border-color:#fecdd3; }
    .count.lvA { background:#fff3c4; border-color:#fde68a; }
    .count.lvB { background:#e0efff; border-color:#bfdbfe; }
    .count.lvC { background:#f3f4f6; border-color:#e5e7eb; }
    .card { border:1px solid #e5e7eb; border-radius:.75rem; padding:.75rem; background:#fff; }
    .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:1rem; align-items:start; }
    .pool { display:grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap:.5rem; }
    .pool-item { padding:.45rem .6rem; border-radius:.6rem; border:1px solid #e5e7eb; background:#fff; }
    .pool-item-inner { display:flex; align-items:center; gap:.5rem; }
    .right { margin-left:auto; display:flex; align-items:center; gap:.4rem; }
    .muted { color:#6b7280; }
    #result { margin:.5rem 0; max-height:220px; overflow:auto; padding-right:.25rem; }
    #history { margin:.5rem 0; max-height:240px; overflow:auto; padding-right:.25rem; }
    .summary-line { margin:.25rem 0; }
    .toolbar { display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; margin-bottom:.5rem; }
    .nowrap { white-space:nowrap; }
    .price-input { width:7.5rem; }
    h1 { margin:.5rem 0; }
  </style>
</head>
<body>
  <h1>三合一轉蛋機｜瑪奇（緋紅夜曲箱子）</h1>

  <div class="topbar">
    <label>選擇轉蛋：
      <select id="machine-select"></select>
    </label>

    <button class="primary" onclick="draw(1)">抽 1 次</button>
    <button class="primary" onclick="draw(11)">抽 11 次</button>
    <button class="primary" onclick="draw(100)">抽 100 次</button>

    <button id="btn-eu" class="toggle" onclick="toggleEU()">歐洲人 BUFF（S×2）</button>
    <button id="btn-af" class="toggle" onclick="toggleAF()">汪汪盤子（溫和 DEBUFF）</button>

    <button class="ghost" onclick="downloadCSV()">下載歷史 CSV</button>
    <button class="warn" onclick="clearHistory()">清除紀錄</button>
  </div>

  <!-- 價格計算器＋價值統計 -->
  <div class="card" style="margin-bottom:1rem;">
    <div>目前轉蛋：<b id="machine-name">—</b>｜模式：<span id="mode">一般</span></div>
    <div class="nowrap">
      累積抽數：<span id="total-draws">0</span> 次｜累積花費：NT$ <span id="total-cost">0</span>｜
      每抽：NT$
      <input id="price-per-draw" type="number" min="0" step="1" class="price-input" style="width:6rem">
    </div>
    <div class="nowrap">
      本期累積價值：NT$ <span id="total-value">0</span>｜
      損益（價值－花費）：NT$ <span id="total-profit">0</span>
    </div>
    <div class="nowrap" style="margin-top:.35rem;">
      自訂估算：
      <input id="calc-n" type="number" min="1" step="1" value="10" />
      <button class="ghost" onclick="estimateCost()">估算價格</button>
      <span id="calc-out" class="muted"></span>
    </div>
  </div>

  <div class="grid-2">
    <div class="card">
      <div id="summary" class="summary-line"></div>
      <div class="summary-line muted" id="rates"></div>
      <div id="result"></div>
      <canvas id="chart" width="400" height="200" style="max-width:100%;"></canvas>
    </div>

    <div class="card">
      <h2>獎勵池（顏色區分 S/A/B/C）</h2>
      <div class="toolbar">
        <label><input type="checkbox" id="toggle-drawn"> 只顯示抽過</label>
        <label><input type="checkbox" id="toggle-sort-count"> 依抽次排序（多→少）</label>
        <label><input type="checkbox" id="toggle-sort-rarity"> 依稀有度排序（S→C）</label>
        <input type="text" id="search" placeholder="搜尋名稱…">
      </div>
      <div id="pool"></div>
    </div>
  </div>

  <div class="card" style="margin-top:1rem;">
    <h2>歷史紀錄（保存於本機；各轉蛋獨立）</h2>
    <div id="history"></div>
  </div>

<script>
/* ===================== 設定區 ===================== */
const DEFAULT_PRICE = 25; // 每抽 NT$
const MACHINES = {
  royal: {
    name: "皇家普利莫學院箱子",
    price: DEFAULT_PRICE,
    rarities: ["S","A","B","C"],
    lsKey: "mabi_multi_royal_v2",
    pool: [
      { level: "S", name: "特別皇家普利莫學院制服(男性用)", prob: 0.0694 },
      { level: "S", name: "特別皇家普利莫學院制服(女性用)", prob: 0.0694 },
      { level: "S", name: "性轉的特別皇家普利莫學院制服(男性用)", prob: 0.0694 },
      { level: "S", name: "性轉的特別皇家普利莫學院制服(女性用)", prob: 0.0694 },
      { level: "S", name: "皇家普利莫學院制服(男性用)", prob: 0.0938 },
      { level: "S", name: "皇家普利莫學院制服(女性用)", prob: 0.0938 },
      { level: "S", name: "皇家普利莫學院手腕裝飾(男性用)", prob: 0.1126 },
      { level: "S", name: "皇家普利莫學院手腕裝飾(女性用)", prob: 0.1126 },
      { level: "S", name: "皇家普利莫學院鞋子(男性用)", prob: 0.1126 },
      { level: "S", name: "皇家普利莫學院鞋子(女性用)", prob: 0.1126 },
      { level: "S", name: "性轉的皇家普利莫學院制服(男性用)", prob: 0.0938 },
      { level: "S", name: "性轉的皇家普利莫學院制服(女性用)", prob: 0.0938 },
      { level: "S", name: "性轉的皇家普利莫學院手腕裝飾(男性用)", prob: 0.1126 },
      { level: "S", name: "性轉的皇家普利莫學院手腕裝飾(女性用)", prob: 0.1126 },
      { level: "S", name: "性轉的皇家普利莫學院鞋子(男性用)", prob: 0.1126 },
      { level: "S", name: "性轉的皇家普利莫學院鞋子(女性用)", prob: 0.1126 },
      { level: "S", name: "皇家普利莫學院帽子", prob: 0.1126 },
      { level: "S", name: "特別的皇家普利莫學院書包(魔力賦予)", prob: 0.0694 },
      { level: "S", name: "優雅皇家普利莫學院書包", prob: 0.3189 },
      { level: "S", name: "沉穩皇家普利莫學院書包", prob: 0.3189 },
      { level: "S", name: "精靈形象變換藥水(童話妖精)", prob: 0.3189 },
      { level: "S", name: "精靈形象變換藥水(童心氣球)", prob: 0.3189 },
      { level: "S", name: "大型風車雙手劍外型卷軸", prob: 0.3189 },
      { level: "S", name: "直笛魔杖外型卷軸", prob: 0.3189 },
      { level: "S", name: "浪漫農場守候的鐘樓", prob: 0.3189 },
      { level: "S", name: "守候的鐘樓", prob: 0.3189 },
      { level: "S", name: "幻想中的世界之樹第2稱號取得券", prob: 0.3189 },
      { level: "S", name: "幻想中的魔法之城第2稱號取得券", prob: 0.3189 },
      { level: "S", name: "歐哈德第2稱號兌換券", prob: 0.0150 },
      { level: "S", name: "蘿晚第2稱號兌換券", prob: 0.0150 },
      { level: "S", name: "伊歐拉第2稱號兌換券", prob: 0.0150 },
      { level: "S", name: "馬特烏斯第2稱號兌換券", prob: 0.0150 },
      { level: "S", name: "羅西尼第2稱號兌換券", prob: 0.0150 },
      { level: "S", name: "卡薇娜第2稱號兌換券", prob: 0.0150 },
      { level: "S", name: "特別的夢幻之蝶第2稱號兌換卷", prob: 0.0150 },
      { level: "S", name: "特別的夢幻之花第2稱號兌換券", prob: 0.0150 },
      { level: "S", name: "特殊白色的治癒師第2稱號取得券", prob: 0.0600 },
      { level: "S", name: "特別秘密別墅的象徵第2稱號兌換券", prob: 0.0338 },
      { level: "S", name: "領悟的圖樣第2稱號兌換券", prob: 0.0338 },
      { level: "S", name: "特別茂密森林的呼喚第2稱號兌換券", prob: 0.0413 },
      { level: "S", name: "特別柔和繡球花水藍第2稱號兌換券", prob: 0.0413 },
      { level: "S", name: "特別絕對睿智的第2稱號兌換券", prob: 0.0563 },
      { level: "S", name: "特別灰暗繡球花水藍第2稱號兌換券", prob: 0.0563 },
      { level: "S", name: "特別芬芳花香的呼喚第2稱號兌換券", prob: 0.0657 },
      { level: "S", name: "休憩的圖樣第2稱號兌換券", prob: 0.0657 },
      { level: "S", name: "狂亂的圖樣第2稱號兌換券", prob: 0.0657 },
      { level: "S", name: "特別虛空蝴蝶第2稱號兌換卷", prob: 0.0657 },
      { level: "S", name: "特別蜻蜓軌跡第2稱號取得券", prob: 0.0657 },
      { level: "S", name: "特別絕對支配的第2稱號兌換券", prob: 0.0657 },
      { level: "S", name: "被封印的魔女第2稱號兌換券", prob: 0.0657 },
      { level: "A", name: "英倫魅力貓咪光環", prob: 0.7504 },
      { level: "A", name: "提拉米蘇生乳捲光環", prob: 0.8254 },
      { level: "A", name: "桃粉高貴人偶光環", prob: 0.8254 },
      { level: "A", name: "月光森林守護者的皎月光環", prob: 0.8254 },
      { level: "A", name: "精靈形象變換藥水(迷霧花漾誘惑)", prob: 0.8254 },
      { level: "A", name: "閃耀森林裝飾(臉部裝飾欄位專用)", prob: 0.8254 },
      { level: "A", name: "龍翅膀模樣頭飾(臉部裝飾欄位專用)", prob: 0.8629 },
      { level: "A", name: "莊嚴的紫色光環", prob: 0.9005 },
      { level: "A", name: "黑玫瑰光環", prob: 0.9380 },
      { level: "A", name: "魔女斯卡哈耳環(臉部裝飾欄位專用)", prob: 0.9380 },
      { level: "A", name: "金色仙界幻想聖人光環", prob: 0.9755 },
      { level: "A", name: "日常潮流熊娃娃鈍器外型卷軸", prob: 1.0505 },
      { level: "A", name: "童話園藝師庭園剪刀外型卷軸", prob: 1.0881 },
      { level: "A", name: "萬聖節蜘蛛騎槍外型卷軸", prob: 1.0881 },
      { level: "A", name: "藍月高貴人偶光環", prob: 1.0881 },
      { level: "A", name: "寶寶小鴨香蕉雙槍外型卷軸", prob: 1.1256 },
      { level: "A", name: "陰陽之神太陽騎槍外型卷軸", prob: 1.1256 },
      { level: "A", name: "蘊含彩霞大海的光環", prob: 1.1256 },
      { level: "A", name: "邱比特愛心光環", prob: 1.1256 },
      { level: "A", name: "闇黑光芒光環", prob: 1.1256 },
      { level: "A", name: "藍玫瑰花冠光環", prob: 1.1256 },
      { level: "A", name: "惡魔權杖特別光環", prob: 1.1256 },
      { level: "B", name: "凱爾特皇家騎士劍(魔力賦予:獅子獵人, 冰碎片)(細工1等級)", prob: 1.5008 },
      { level: "B", name: "凱爾特皇家鬥斧(魔力賦予:公爵, 角)(細工1等級)", prob: 1.5008 },
      { level: "B", name: "凱爾特皇家戰錘(魔力賦予:吉爾迦斯,震驚的)(細工1等級)", prob: 1.5008 },
      { level: "B", name: "獅子獵人破壞的被詛咒的暗殺者之劍 (最高級型)細工1等級)", prob: 1.5008 },
      { level: "B", name: "常春藤靈巧皇家公主頭冠細工1等級", prob: 1.5008 },
      { level: "B", name: "凱爾特皇家戰斧(魔力賦予:吉爾迦斯,震驚的)(細工1等級)", prob: 1.5008 },
      { level: "B", name: "凱爾特戰斧(魔力賦予:破壞的, 震驚的)(細工1等級)", prob: 1.5008 },
      { level: "B", name: "常春藤靈巧皇家王子頭冠細工1等級", prob: 1.5008 },
      { level: "B", name: "波希米亞人花手環 (女性用)(最高級型)", prob: 1.5008 },
      { level: "B", name: "敏捷的優雅的皇家王子靴子細工1等級", prob: 1.5008 },
      { level: "B", name: "復仇者塔拉突擊步兵鎧甲 (巨人男性用) (最高級型) 細工1等級", prob: 1.5008 },
      { level: "B", name: "基礎的皇家公主盔甲 細工1等級", prob: 1.5008 },
      { level: "B", name: "凱爾特皇家弩(魔力賦予:燕子)(細工1等級)", prob: 1.5008 },
      { level: "B", name: "黑龍騎士之弓 細工1等級(高級型/ 1等級)", prob: 1.5008 },
      { level: "B", name: "常春藤塔拉突擊步兵頭盔 (巨人女性專用) (最高級型) 細工1等級", prob: 1.5008 },
      { level: "B", name: "凱爾特鬥斧(魔力賦予:公爵,角)(細工1等級)", prob: 1.5008 },
      { level: "B", name: "凱爾特鬥錘(魔力賦予:破壞的, 震驚的)(細工1等級)", prob: 1.5008 },
      { level: "B", name: "波希米亞人靴子(男性用) (最高級型)", prob: 1.5008 },
      { level: "B", name: "凱爾特皇家鬥錘(魔力賦予:公爵, 冰碎片)(細工1等級)", prob: 1.5008 },
      { level: "B", name: "波希米亞人靴子(女性用) (最高級型)", prob: 1.5008 },
      { level: "B", name: "常春藤塔拉突擊步兵頭盔 (巨人男性專用) (最高級型) 細工1等級", prob: 1.5008 },
      { level: "B", name: "增幅催化劑塔拉突擊步兵手套 (巨人女性專用)(最高級型) 細工1等級", prob: 1.5008 },
      { level: "B", name: "波希米服裝(女性用)(最高級型)", prob: 1.5008 },
      { level: "B", name: "復仇者塔拉突擊步兵鎧甲 (男性用) (最高級型) 細工1等級", prob: 1.5008 },
      { level: "C", name: "波希米亞人手環 (男性用)(最高級型)", prob: 1.5195 },
      { level: "C", name: "凱爾特鬥錘(魔力賦予:公爵, 冰碎片)(細工1等級)", prob: 1.5195 },
      { level: "C", name: "塔烏拉黃金槍(骨碌+閃亮)1等級(高級型/ 1等級)", prob: 1.5195 },
      { level: "C", name: "復仇者塔拉突擊步兵鎧甲 (巨人女性用) (最高級型) 細工1等級", prob: 1.5195 },
      { level: "C", name: "波希米服裝(男性用) (最高級型)", prob: 1.5195 },
      { level: "C", name: "凱爾特弩(魔力賦予:隱身處)(細工1等級)", prob: 1.5195 },
      { level: "C", name: "黑星(閃亮閃亮) 1等(高級型/ 1等級)", prob: 1.5195 },
      { level: "C", name: "滿月刺殺鎖鏈鐮刃 2等級", prob: 1.5195 },
      { level: "C", name: "魯艾利闊劍 細工1等級(高級型/ 1等級)", prob: 1.5195 },
      { level: "C", name: "獅子獵人冰碎片戰爭之劍(最高級型)細工1等級", prob: 1.5195 },
      { level: "C", name: "優雅的塔拉突擊步兵長靴 (巨人男性專用)(最高級型) 細工1等級", prob: 1.5195 },
      { level: "C", name: "獅子獵人破壞的雙手劍(最高級型)細工1等級", prob: 1.5195 },
      { level: "C", name: "獅子獵人冰碎片法蘭西戰斧(最高級型)細工1等級", prob: 1.5195 },
      { level: "C", name: "獅子獵人破壞的蘇格蘭高地闊刃雙手劍(最高級型)細工1等級", prob: 1.5195 },
      { level: "C", name: "獅子獵人冰碎片曲鉤短劍(最高級型)細工1等級", prob: 1.5195 },
      { level: "C", name: "獅子獵人破壞的闊刃雙手劍(最高級型)細工1等級", prob: 1.5195 },
      { level: "C", name: "優雅的塔拉突擊步兵長靴 (男性專用)(最高級型) 細工1等級", prob: 1.5195 },
      { level: "C", name: "優雅的塔拉突擊步兵長靴 (巨人女性專用) (最高級型) 細工1等級", prob: 1.5195 },
      { level: "C", name: "獅子獵人破壞的翼魔之劍(最高級型)細工1等級", prob: 1.5195 },
      { level: "C", name: "殘月初始鎖鏈鐮刃 2等級", prob: 1.5195 },
      { level: "C", name: "獅子獵人不停歇的闊劍(最高級型)細工1等級", prob: 1.5195 },
      { level: "C", name: "獅子獵人冰碎片巨劍(最高級型)細工1等級", prob: 1.5195 },
      { level: "C", name: "獅子獵人冰碎片古羅馬短劍(最高級型)細工1等級", prob: 1.5195 },
      { level: "C", name: "獅子獵人冰碎片釘錘(最高級型)細工1等級", prob: 1.5195 }
    ]
  },

  celtic: {
    name: "凱爾特經典箱子",
    price: DEFAULT_PRICE,
    rarities: ["S","A","B","C"],
    lsKey: "mabi_multi_celtic_v2",
    pool: [
      { level: "S", name: "燦爛的凱爾特經典風格翅膀", prob: 0.1953 },
      { level: "S", name: "強烈的凱爾特經典風格翅膀", prob: 0.1953 },
      { level: "S", name: "冷靜的凱爾特經典風格翅膀", prob: 0.1775 },
      { level: "S", name: "純粹的凱爾特經典風格翅膀", prob: 0.1775 },
      { level: "S", name: "特別凱爾特經典風格服裝(男性用)", prob: 0.0675 },
      { level: "S", name: "特別凱爾特經典風格服裝(女性用)", prob: 0.0675 },
      { level: "S", name: "凱爾特經典風格服裝(男性用)", prob: 0.1349 },
      { level: "S", name: "凱爾特經典風格服裝(女性用)", prob: 0.1349 },
      { level: "S", name: "凱爾特經典風格手部裝飾(男性用)", prob: 0.1953 },
      { level: "S", name: "凱爾特經典風格手部裝飾(女性用)", prob: 0.1953 },
      { level: "S", name: "凱爾特經典風格鞋子(男性用)", prob: 0.1953 },
      { level: "S", name: "凱爾特經典風格鞋子(女性用)", prob: 0.1953 },
      { level: "S", name: "凱爾特經典風格帽子", prob: 0.1953 },
      { level: "S", name: "雷擊特效變更卡(嗜血雷電)兌換券", prob: 0.1953 },
      { level: "S", name: "雷擊特效變更卡(淨白雷電)兌換券", prob: 0.1953 },
      { level: "S", name: "猛擊特效變更卡(星芒淨空)兌換券", prob: 0.1953 },
      { level: "S", name: "星象輪迴特效變更卡片(藍色黃玉蝴蝶)兌換券", prob: 0.1953 },
      { level: "S", name: "星象輪迴特效變更卡片(暗黑瑪瑙蝴蝶)兌換券", prob: 0.1953 },
      { level: "S", name: "星之引爆特效變更卡片(藍色黃玉蝴蝶)兌換券", prob: 0.1953 },
      { level: "S", name: "星之引爆特效變更卡片(暗黑瑪瑙蝴蝶)兌換券", prob: 0.1953 },
      { level: "S", name: "凱爾特經典力場之弓外型卷軸", prob: 0.1953 },
      { level: "S", name: "凱爾特經典風格之弓外型卷軸", prob: 0.1953 },
      { level: "S", name: "凱爾特經典力場巨劍外型卷軸", prob: 0.1953 },
      { level: "S", name: "凱爾特經典風格巨劍外型卷軸", prob: 0.1953 },
      { level: "S", name: "凱爾特經典力場集魔杖外型卷軸", prob: 0.1953 },
      { level: "S", name: "凱爾特經典風格集魔杖外型卷軸", prob: 0.1953 },
      { level: "S", name: "凱爾特經典力場雙槍外型卷軸", prob: 0.1953 },
      { level: "S", name: "凱爾特經典風格雙槍外型卷軸", prob: 0.1953 },
      { level: "S", name: "力量之斧(最高級)", prob: 0.0284 },
      { level: "S", name: "智慧披風(最高級)", prob: 0.0284 },
      { level: "S", name: "艾伊洛魔力賦予卷軸兌換券", prob: 0.0533 },
      { level: "S", name: "魔法頭盔(最高級)", prob: 0.0284 },
      { level: "S", name: "伊卡洛斯魔力賦予卷軸兌換券", prob: 0.0639 },
      { level: "S", name: "被遺忘的天使之羽(移動速度圖騰)", prob: 0.0639 },
      { level: "S", name: "治癒之井(最高級)", prob: 0.0284 },
      { level: "S", name: "魔法盾牌(最高級)", prob: 0.0284 },
      { level: "S", name: "寶藏背包(最高級)", prob: 0.0284 },
      { level: "S", name: "真實之杯", prob: 0.0692 },
      { level: "S", name: "鎮波號", prob: 0.0692 },
      { level: "S", name: "天空的羽毛(移動速度圖騰)", prob: 0.0533 },
      { level: "S", name: "兀特尼", prob: 0.0781 },
      { level: "S", name: "黑風暴魔力賦予卷軸兌換券", prob: 0.0639 },
      { level: "S", name: "疾飛魔力賦予卷軸兌換券", prob: 0.0639 },
      
      { level: "A", name: "薄荷巧克力生乳捲光環", prob: 0.7456 },
      { level: "A", name: "神獸的守護者獨眼裝飾(臉部裝飾欄位專用)", prob: 0.7811 },
      { level: "A", name: "繡球花藍色眼罩(臉部裝飾欄位專用)", prob: 0.7811 },
      { level: "A", name: "皇家學會星塵的形象", prob: 0.7811 },
      { level: "A", name: "世界流浪者鎖鏈鐮刃外型卷軸", prob: 0.7811 },
      { level: "A", name: "桃粉貴族人偶光環", prob: 0.7811 },
      { level: "A", name: "精靈形象變換藥水(無限地獄)", prob: 0.7811 },
      { level: "A", name: "暗影刺客手裏劍外型變更卷軸", prob: 0.8166 },
      { level: "A", name: "熾天使歌唱裝飾眼鏡(臉部裝飾欄位專用)", prob: 0.8166 },
      { level: "A", name: "皇家學會鐮刀外型變更卷軸", prob: 0.8876 },
      { level: "A", name: "彩色光彩劍外型變更卷軸", prob: 0.8876 },
      { level: "A", name: "陰陽之神月亮魔杖外型卷軸", prob: 0.8876 },
      { level: "A", name: "邪惡兔兔眼罩(臉部裝飾欄位專用)", prob: 0.8876 },
      { level: "A", name: "浪漫海賊團船長的華麗的寶石之劍外型卷軸", prob: 0.8876 },
      { level: "A", name: "擁抱春天的櫻花樹光環", prob: 0.9231 },
      { level: "A", name: "暗影刺客雙槍外型變更卷軸", prob: 0.9586 },
      { level: "A", name: "甜美可愛熊娃娃鈍器外型卷軸", prob: 0.9586 },
      { level: "A", name: "尊爵的神特別光環", prob: 0.9941 },
      { level: "A", name: "祕密別墅基本款太陽眼鏡(臉部裝飾欄位專用)", prob: 0.9941 },
      { level: "A", name: "黃玉光均衡光環", prob: 1.0296 },
      { level: "A", name: "燦爛的闇黑之月光環", prob: 1.0296 },
      { level: "A", name: "深夜闇影花邊面具", prob: 1.0296 },
      { level: "A", name: "深邃黑洞紫羅蘭光環", prob: 1.0652 },
      { level: "A", name: "水上樂園光環", prob: 1.0652 },
      { level: "A", name: "佛羅倫斯舞會鑽石耳環(臉部裝飾欄位專用)", prob: 1.0652 },
      { level: "A", name: "皇家茶杯耳環(臉部裝飾欄位專用)", prob: 1.0652 },
      { level: "A", name: "圖紋臉頰與額頭裝飾(臉部裝飾欄位專用)", prob: 1.0652 },
      { level: "A", name: "邱比特雙愛心光環", prob: 1.0652 },
      { level: "A", name: "海洋水手緞帶光環", prob: 1.0652 },
      
      { level: "B", name: "雷比斯盾牌鋼瓶 細工1等級", prob: 1.3847 },
      { level: "B", name: "阿多尼斯服裝(女性用)(細工1等級/最高級型)", prob: 1.3847 },
      { level: "B", name: "阿多尼斯服裝(男性用)(細工1等級/最高級型)", prob: 1.3847 },
      { level: "B", name: "貝爾蒙特手套(最高級型) 細工1等級", prob: 1.3847 },
      { level: "B", name: "阿多尼斯鞋子(男性用)(細工1等級/最高級型)", prob: 1.3847 },
      { level: "B", name: "托爾維斯的盔甲 細工1等級 (高級型) / 經驗值 500%", prob: 1.3847 },
      { level: "B", name: "斷角修行者帽子(最高級型)細工1等級", prob: 1.3847 },
      { level: "B", name: "破損魂修行者手套(巨人用)(最高級型)細工1等級", prob: 1.3847 },
      { level: "B", name: "阿多尼斯鞋子(女性用)(細工1等級/最高級型)", prob: 1.3847 },
      { level: "B", name: "艾薇琳的手套 細工1等級 (高級型) / 經驗值 500%", prob: 1.3847 },
      { level: "B", name: "阿多尼斯帽子(男性用)(細工1等級/最高級型)", prob: 1.3847 },
      { level: "B", name: "貝爾蒙特服裝 (女性用)(最高級型) 細工1等級", prob: 1.3847 },
      { level: "B", name: "貝爾蒙特鞋子 (女性用)(最高級型) 細工1等級", prob: 1.3847 },
      { level: "B", name: "黑龍騎士之弓 細工1等級", prob: 1.3847 },
      { level: "B", name: "貝爾蒙特帽子(女性用)(最高級型) 細工1等級", prob: 1.3847 },
      { level: "B", name: "斷角修行服(最高級型) 細工1等級", prob: 1.3847 },
      { level: "B", name: "貝爾蒙特帽子(男性用)(最高級型) 細工1等級", prob: 1.3847 },
      { level: "B", name: "斷角獵人修行服(巨人)(最高級型)細工1等級", prob: 1.3847 },
      { level: "B", name: "貝爾蒙特服裝(男性用)(最高級型) 細工1等級", prob: 1.3847 },
      { level: "B", name: "斷角獵人手套(巨人)(最高級型)細工1等級", prob: 1.3847 },
      { level: "B", name: "聊天姿勢卡片", prob: 1.3847 },
      { level: "B", name: "貝爾蒙特鞋子(男性用)(最高級型) 細工1等級", prob: 1.3847 },
      { level: "B", name: "高出力白光劍", prob: 1.3847 },
      { level: "B", name: "高出力紅光劍", prob: 1.3847 },
      
      { level: "C", name: "名稱/聊天指定顏色變更藥水 (30天)", prob: 1.4202 },
      { level: "C", name: "名稱/聊天指定顏色變更藥水 (30天)", prob: 1.4202 },
      { level: "C", name: "名稱/聊天指定顏色變更藥水 (30天)", prob: 1.4202 },
      { level: "C", name: "名稱/聊天指定顏色變更藥水 (30天)", prob: 1.4202 },
      { level: "C", name: "名稱/聊天指定顏色變更藥水 (30天)", prob: 1.4202 },
      { level: "C", name: "名稱/聊天指定顏色變更藥水 (30天)", prob: 1.4202 },
      { level: "C", name: "名稱/聊天指定顏色變更藥水 (30天)", prob: 1.4202 },
      { level: "C", name: "斷角獵人盔甲(巨人)(最高級型) 細工1等級", prob: 1.4202 },
      { level: "C", name: "左顧右盼姿勢卡片", prob: 1.4202 },
      { level: "C", name: "斷角修行者手套(巨人)(最高級型)細工1等級", prob: 1.4202 },
      { level: "C", name: "黑星 細工1等級", prob: 1.4202 },
      { level: "C", name: "亞特的靴子 細工1等級 (高級型) / 經驗值 500%", prob: 1.4202 },
      { level: "C", name: "魯艾利闊劍 細工1等級", prob: 1.4202 },
      { level: "C", name: "托爾維斯的靴子 細工1等級 (高級型) / 經驗值 500%", prob: 1.4202 },
      { level: "C", name: "艾薇琳的盔甲 細工1等級 (高級型) / 經驗值 500%", prob: 1.4202 },
      { level: "C", name: "黑龍騎士之劍 細工1等級", prob: 1.4202 },
      { level: "C", name: "亞特的手套 細工1等級 (高級型) / 經驗值 500%", prob: 1.4202 },
      { level: "C", name: "托爾維斯的手套 細工1等級 (高級型) / 經驗值 500%", prob: 1.4202 },
      { level: "C", name: "亞特的盔甲 細工1等級 (高級型) / 經驗值 500%", prob: 1.4202 },
      { level: "C", name: "健忘姿勢卡片", prob: 1.4202 },
      { level: "C", name: "頭痛姿勢卡片", prob: 1.4202 },
      { level: "C", name: "巴結姿勢卡片", prob: 1.4202 },
      { level: "C", name: "歡呼姿勢卡片", prob: 1.4202 },
      { level: "C", name: "梅林的希里原魔力拳套 細工1等級", prob: 1.4202 }
    ]
  },

  whistle: {
    name: "哨子轉蛋機",
    price: DEFAULT_PRICE,
    rarities: ["S","A","B"],
    lsKey: "mabi_multi_whistle_v2",
    pool: [
      { level:"S", name:"害羞兔寶哨子",        prob:1.0929 },
      { level:"S", name:"搞怪兔寶哨子",        prob:1.0929 },
      { level:"S", name:"傲慢兔寶哨子",        prob:1.0929 },
      { level:"S", name:"沉穩兔寶哨子",        prob:1.0929 },
      { level:"S", name:"紅炎的精靈龍哨子",    prob:2.7322 },
      { level:"S", name:"翠草的精靈龍哨子",    prob:2.7322 },
      { level:"S", name:"蒼冰的精靈龍哨子",    prob:2.7322 },
      { level:"S", name:"兔寶餅乾餐車哨子",    prob:4.0984 },
      { level:"S", name:"兔子魔族牌摩托車哨子",prob:4.0984 },
      { level:"S", name:"水晶小白鯨哨子",      prob:4.0984 },
      { level:"S", name:"閃亮小白鯨哨子",      prob:4.0984 },
      { level:"S", name:"繁星小白鯨哨子",      prob:4.0984 },
      { level:"S", name:"櫻花小白鯨哨子",      prob:4.0984 },
      { level:"A", name:"天使貓哨子",          prob:5.4645 },
      { level:"A", name:"墮天使貓哨子",        prob:5.4645 },
      { level:"A", name:"圖安之魂哨子",        prob:5.4645 },
      { level:"A", name:"蒼龍哨子",            prob:5.4645 },
      { level:"B", name:"士官學校黑馬哨子",    prob:8.1967 },
      { level:"B", name:"士官學校白馬哨子",    prob:8.1967 },
      { level:"B", name:"黃金餐車哨子",        prob:8.1967 },
      { level:"B", name:"安布利斯雷龍(2人用)哨子", prob:8.1967 },
      { level:"B", name:"速克達哨子",          prob:8.1967 }
    ]
  },

  oriental: {
    name: "東方歲慶箱子",
    price: DEFAULT_PRICE,
    rarities: ["S","A","B","C"],
    lsKey: "mabi_multi_oriental_v2",
    pool: [
      /* S 等級 */
      { level:"S", name:"特別東方歲慶服裝(男性用)", prob:0.0687 },
      { level:"S", name:"特別東方歲慶洋裝(女性用)", prob:0.0687 },
      { level:"S", name:"東方歲慶服裝(男性用)", prob:0.1375 },
      { level:"S", name:"東方歲慶洋裝(女性用)", prob:0.1375 },
      { level:"S", name:"東方歲慶手套(男性用)", prob:0.1933 },
      { level:"S", name:"東方歲慶手套(女性用)", prob:0.1933 },
      { level:"S", name:"東方歲慶鞋子(男性用)", prob:0.1933 },
      { level:"S", name:"東方歲慶鞋子(女性用)", prob:0.1933 },
      { level:"S", name:"東方歲慶假髮(男性用)", prob:0.1933 },
      { level:"S", name:"東方歲慶假髮(女性用)", prob:0.1933 },
      { level:"S", name:"東方歲慶雨傘光環", prob:0.2578 },
      { level:"S", name:"東方歲慶狐狸面具(臉部裝飾欄位專用)", prob:0.2578 },
      { level:"S", name:"東方歲慶星塵形象", prob:0.2578 },
      { level:"S", name:"東方歲慶燈籠集魔杖外形變更卷軸", prob:0.1074 },
      { level:"S", name:"東方歲慶鞭炮騎槍外形變更卷軸", prob:0.1074 },
      { level:"S", name:"梅花樹下之湖", prob:0.1074 },
      { level:"S", name:"蓮上之景", prob:0.1074 },
      { level:"S", name:"玉蘭花開之際", prob:0.1074 },
      { level:"S", name:"鳳凰夢境", prob:0.1074 },
      { level:"S", name:"紅梅的低語", prob:0.1074 },
      { level:"S", name:"浪漫農場梅花樹下之湖", prob:0.1074 },
      { level:"S", name:"浪漫農場蓮上之景", prob:0.1074 },
      { level:"S", name:"浪漫農場玉蘭花開之際", prob:0.1074 },
      { level:"S", name:"浪漫農場鳳凰夢境", prob:0.1074 },
      { level:"S", name:"浪漫農場紅梅的低語", prob:0.1074 },
      { level:"S", name:"特別的青龍戀人服裝(女性用)", prob:0.1074 },
      { level:"S", name:"特別的青龍戀人服裝(男性用)", prob:0.1074 },
      { level:"S", name:"青龍戀人鞋子(女性用)", prob:0.3007 },
      { level:"S", name:"青龍戀人鞋子(男性用)", prob:0.3007 },
      { level:"S", name:"特別的月下的陰間使者服裝(男性用)", prob:0.1375 },
      { level:"S", name:"特別的黎明的陰間使者服裝(男性用)", prob:0.1375 },
      { level:"S", name:"特別的黎明的陰間使者服裝(女性用)", prob:0.1375 },
      { level:"S", name:"特別的月下的陰間使者服裝(女性用)", prob:0.1375 },
      { level:"S", name:"增高鞋墊", prob:0.0666 },
      { level:"S", name:"透明翅膀", prob:0.0644 },
      { level:"S", name:"火球魔法特效變更卡片(玫瑰) 兌換券", prob:0.1074 },
      { level:"S", name:"戰場的序曲特效變更卡片(邪惡兔兔)兌換券", prob:0.0902 },
      { level:"S", name:"聖靈同步特效變更卡片(可愛玫瑰)兌換券", prob:0.1074 },
      { level:"S", name:"聖靈同步特效變更卡片(藍玫瑰)兌換券", prob:0.1074 },
      { level:"S", name:"戰場的序曲特效變更卡片(優雅的邪惡兔兔)兌換券", prob:0.0666 },

      /* A 等級 */
      { level:"A", name:"青龍的戀人手套(男性用)", prob:0.8593 },
      { level:"A", name:"青龍的戀人手套(女性用)", prob:0.8593 },
      { level:"A", name:"月下的陰間使者鞋子(女性用)", prob:0.6444 },
      { level:"A", name:"月下的陰間使者鞋子(男性用)", prob:0.6444 },
      { level:"A", name:"月下的陰間使者手套(男性用)", prob:0.4296 },
      { level:"A", name:"月下的陰間使者手套(女性用)", prob:0.4296 },
      { level:"A", name:"月下的陰間使者服裝(女性用)", prob:0.6444 },
      { level:"A", name:"月下的陰間使者服裝(男性用)", prob:0.6444 },
      { level:"A", name:"黎明的陰間使者服裝(男性用)", prob:0.8593 },
      { level:"A", name:"黎明的陰間使者服裝(女性用)", prob:0.8593 },
      { level:"A", name:"青龍戀人服裝(男性用)", prob:0.6444 },
      { level:"A", name:"青龍戀人服裝(女性用)", prob:0.6444 },
      { level:"A", name:"月下的陰間使者假髮(男性用)", prob:0.4296 },
      { level:"A", name:"月下的陰間使者假髮(女性用)", prob:0.4296 },
      { level:"A", name:"春季皇家王冠光環", prob:0.6444 },
      { level:"A", name:"芬芳花冠光環", prob:0.6444 },
      { level:"A", name:"檸檬氣泡光環", prob:0.8593 },
      { level:"A", name:"巧克力音樂家光環", prob:0.8593 },
      { level:"A", name:"高潔的夢幻的獨角獸光環", prob:0.8593 },
      { level:"A", name:"神聖奇蹟光環", prob:0.4296 },
      { level:"A", name:"煉獄業火眉心點(臉部裝飾欄位專用)", prob:0.6444 },
      { level:"A", name:"黑眼圈濾鏡(臉部裝飾欄位專用)", prob:0.4296 },
      { level:"A", name:"稀原寶石裝飾(臉部裝飾欄位專用)", prob:0.6444 },
      { level:"A", name:"駭客護目鏡(臉部裝飾欄位專用)", prob:0.4296 },
      { level:"A", name:"煉獄業火的證明(臉部裝飾欄位專用)", prob:0.4296 },
      { level:"A", name:"十字帝國巨劍外型卷軸", prob:0.8593 },
      { level:"A", name:"貴族庭園手把外型卷軸", prob:0.8593 },
      { level:"A", name:"貴族校園魔杖外型卷軸", prob:0.8593 },
      { level:"A", name:"日月之神太陽拳套外型卷軸", prob:0.8593 },
      { level:"A", name:"浪漫海賊團團員的投擲用短刀外型卷軸", prob:0.8593 },
      { level:"A", name:"精靈形象變換藥水(冒出的珠子)", prob:0.8593 },
      { level:"A", name:"精靈形象變換藥水(天界)", prob:0.6444 },

      /* B 等級 */
      { level:"B", name:"阿多尼斯帽子(女性用) )(細工1等級/最高級型)", prob:1.5037 },
      { level:"B", name:"潮濕的惡魔深淵鋼瓶細工1等級", prob:1.5037 },
      { level:"B", name:"敏捷的優雅的闇黑武士靴子(男性用)細工1等級", prob:1.5037 },
      { level:"B", name:"合力惡魔地獄火鋼瓶細工1等級", prob:1.5037 },
      { level:"B", name:"阿多尼斯服裝(女性用) )(細工1等級/最高級型)", prob:1.5037 },
      { level:"B", name:"單色組合-熱情紅", prob:1.5037 },
      { level:"B", name:"冒險家長袍(女性用)(最高級型)", prob:1.5037 },
      { level:"B", name:"阿多尼斯服裝(男性用) )(細工1等級/最高級型)", prob:1.5037 },
      { level:"B", name:"烈焰見習騎士團菁英任務通行證選擇箱子", prob:1.5037 },
      { level:"B", name:"阿多尼斯鞋子(男性用) )(細工1等級/最高級型)", prob:1.5037 },
      { level:"B", name:"阿多尼斯鞋子(女性用) )(細工1等級/最高級型)", prob:1.5037 },
      { level:"B", name:"鍍金的一代宗師證書", prob:1.5037 },
      { level:"B", name:"阿多尼斯帽子(男性用) )(細工1等級/最高級型)", prob:1.5037 },
      { level:"B", name:"烈焰騎士服裝(女性用) 細工1等級", prob:1.5037 },
      { level:"B", name:"烈焰騎士靴子(女性用) 細工1等級", prob:1.5037 },
      { level:"B", name:"敏捷的優雅的闇黑武士盔甲(女性用)細工1等級", prob:1.5037 },
      { level:"B", name:"單色組合-時尚藍", prob:1.5037 },
      { level:"B", name:"單色組合-淘氣黃", prob:1.5037 },
      { level:"B", name:"好學的惡魔無限集魔杖細工1等級", prob:1.5037 },
      { level:"B", name:"艾爾班騎士團的訓練石[難易度-最高級一般]", prob:1.5037 },
      { level:"B", name:"烈焰騎士靴子(男性用) 細工1等級", prob:1.5037 },
      { level:"B", name:"艾爾班騎士團的訓練石[隱藏樓層-神艾托恩的冶煉台]", prob:1.5037 },
      { level:"B", name:"單色組合-戀愛粉紅", prob:1.5037 },
      { level:"B", name:"單色組合-魅力紫", prob:1.5037 },

      /* C 等級 */
      { level:"C", name:"烈焰騎士服裝(男性用) 細工1等級", prob:1.5252 },
      { level:"C", name:"基礎的復仇者闇黑武士盔甲(女性用)細工1等級", prob:1.5252 },
      { level:"C", name:"基礎的復仇者闇黑武士盔甲(男性用)細工1等級", prob:1.5252 },
      { level:"C", name:"冒險家長袍(男性用)(最高級型)", prob:1.5252 },
      { level:"C", name:"指定染色劑(螢光色)#CF1414", prob:1.5252 },
      { level:"C", name:"指定染色劑(螢光藍色)#0000C0", prob:1.5252 },
      { level:"C", name:"指定染色劑(金絲雀黃色)#FFCC33", prob:1.5252 },
      { level:"C", name:"指定染色劑(深石板瓦灰色)#2F4F4F", prob:1.5252 },
      { level:"C", name:"指定染色劑(印地安紅色)#CD5C5C", prob:1.5252 },
      { level:"C", name:"指定染色劑(柳橙萊姆色)#D1D734", prob:1.5252 },
      { level:"C", name:"指定染色劑(藍綠色)#30BA8F", prob:1.5252 },
      { level:"C", name:"指定染色劑(深天空色)#37b5be", prob:1.5252 },
      { level:"C", name:"指定染色劑(系統深灰色)#211c35", prob:1.5252 },
      { level:"C", name:"魔法的染色八分音符", prob:1.5252 },
      { level:"C", name:"魔法的染色八分音符", prob:1.5252 },
      { level:"C", name:"魔法的染色八分音符", prob:1.5252 },
      { level:"C", name:"魔法的染色八分音符", prob:1.5252 },
      { level:"C", name:"魔法的染色八分音符", prob:1.5252 },
      { level:"C", name:"魔法的染色八分音符", prob:1.5252 },
      { level:"C", name:"魔法的染色八分音符", prob:1.5252 },
      { level:"C", name:"魔法的染色八分音符", prob:1.5252 },
      { level:"C", name:"魔法的染色八分音符(米黃色)", prob:1.5252 },
      { level:"C", name:"魔法的染色八分音符(粉色)", prob:1.5252 },
      { level:"C", name:"魔法的染色八分音符(藏青)", prob:1.5252 }
    ]
  },
  
  crimson: {
	name: "緋紅夜曲箱子",
	price: DEFAULT_PRICE,
	rarities: ["S","A","B","C"],
	lsKey: "mabi_multi_crimson_v1",
	pool: [
		// S
		{ level:"S", name:"優雅的緋紅夜曲翅膀", prob:0.1226 },
		{ level:"S", name:"沉穩的緋紅夜曲翅膀", prob:0.1226 },
		{ level:"S", name:"高貴的緋紅夜曲翅膀", prob:0.1226 },
		{ level:"S", name:"空虛的緋紅夜曲翅膀", prob:0.1226 },
		{ level:"S", name:"強烈的緋紅夜曲翅膀", prob:0.1226 },
		{ level:"S", name:"特別緋紅夜曲套裝(男性用)", prob:0.0552 },
		{ level:"S", name:"特別緋紅夜曲洋裝(女性用)", prob:0.0552 },
		{ level:"S", name:"緋紅夜曲套裝(男性用)", prob:0.1288 },
		{ level:"S", name:"緋紅夜曲洋裝(女性用)", prob:0.1288 },
		{ level:"S", name:"緋紅夜曲手套(男性用)", prob:0.1379 },
		{ level:"S", name:"緋紅夜曲手套(女性用)", prob:0.1379 },
		{ level:"S", name:"緋紅夜曲靴子(男性用)", prob:0.1379 },
		{ level:"S", name:"緋紅夜曲鞋子(女性用)", prob:0.1379 },
		{ level:"S", name:"緋紅夜曲假髮(男性用)", prob:0.1226 },
		{ level:"S", name:"緋紅夜曲假髮(女性用)", prob:0.1226 },
		{ level:"S", name:"緋紅夜曲寬帽沿帽子", prob:0.1226 },
		{ level:"S", name:"緋紅夜曲圓帽", prob:0.1226 },
		{ level:"S", name:"瘟疫醫師的面具", prob:0.1379 },
		{ level:"S", name:"瘟疫醫師的長袍", prob:0.1379 },
		{ level:"S", name:"吸血鬼首領的棺材", prob:0.1226 },
		{ level:"S", name:"浪漫農場大廳吊燈", prob:0.1533 },
		{ level:"S", name:"充滿浪漫農場艾維卡的大廳中央階梯", prob:0.1533 },
		{ level:"S", name:"充滿浪漫農場拉狄卡的大廳中央階梯", prob:0.1533 },
		{ level:"S", name:"雪紡水晶星塵形象", prob:0.0920 },
		{ level:"S", name:"日常風格兔子星塵形象", prob:0.1073 },
		{ level:"S", name:"王城魔法師星塵形象", prob:0.1073 },
		{ level:"S", name:"七尾狐星塵形象", prob:0.1134 },
		{ level:"S", name:"特別的世界旅行者服裝(男性用)", prob:0.0920 },
		{ level:"S", name:"特別的世界流浪者服裝(女性用)", prob:0.0920 },
		{ level:"S", name:"世界旅行者服裝(男性用)", prob:0.1226 },
		{ level:"S", name:"世界流浪者服裝(女性用)", prob:0.1226 },
		{ level:"S", name:"世界旅行者靴子(男性用)", prob:0.1226 },
		{ level:"S", name:"世界流浪者靴子(女性用)", prob:0.1226 },
		{ level:"S", name:"世界旅行者假髮(男性用)", prob:0.1073 },
		{ level:"S", name:"世界流浪者假髮(女性用)", prob:0.1073 },
		{ level:"S", name:"用腰帶裝飾的羽毛法師帽", prob:0.1226 },
		{ level:"S", name:"用腰帶裝飾的佛路米貝雷帽", prob:0.1226 },
		{ level:"S", name:"特別暗黑主教長版服裝(男性用)", prob:0.1226 },
		{ level:"S", name:"特別暗黑主教長版禮服(女性用)", prob:0.1226 },
		{ level:"S", name:"特別暗黑主教短版服裝(男性用)", prob:0.1226 },
		{ level:"S", name:"特別暗黑主教短版禮服(女性用)", prob:0.1226 },
		{ level:"S", name:"暗黑主教靴子(男性用)", prob:0.1226 },
		{ level:"S", name:"暗黑主教高跟鞋(女性用)", prob:0.1226 },
		{ level:"S", name:"暗黑主教假髮(男性用)", prob:0.1226 },
		{ level:"S", name:"暗黑主教假髮(女性用)", prob:0.1226 },
		{ level:"S", name:"世界旅行者單手劍外型卷軸", prob:0.1134 },
		{ level:"S", name:"世界旅行者弓外型卷軸", prob:0.1134 },
	
		// A
		{ level:"A", name:"世界流浪者雙手劍外型卷軸", prob:0.3066 },
		{ level:"A", name:"暗黑主教長版服裝(男性用)", prob:0.3066 },
		{ level:"A", name:"暗黑主教長版禮服(女性用)", prob:0.3066 },
		{ level:"A", name:"暗黑主教主教冠(男性用)", prob:0.9197 },
		{ level:"A", name:"暗黑主教主教冠(女性用)", prob:0.9197 },
		{ level:"A", name:"特級魔幻萬聖節法師服裝(男性用)", prob:0.3066 },
		{ level:"A", name:"特級魔幻萬聖節魔女服裝(女性用)", prob:0.3066 },
		{ level:"A", name:"魔幻萬聖節法師皮鞋(男性用)", prob:0.9197 },
		{ level:"A", name:"魔幻萬聖節魔女皮鞋(女性用)", prob:0.9197 },
		{ level:"A", name:"精靈形象變換藥水(深淵閃光火焰)", prob:0.7664 },
		{ level:"A", name:"精靈形象變換藥水(暗黑破壞)", prob:0.9197 },
		{ level:"A", name:"精靈形象變換藥水(影龍)", prob:1.0729 },
		{ level:"A", name:"精靈形象變換藥水(閃爍的新月)", prob:1.0729 },
		{ level:"A", name:"夢幻甜點恐龍娃娃", prob:0.9197 },
		{ level:"A", name:"蝴蝶妖精魔導書", prob:0.9197 },
		{ level:"A", name:"花漾手把", prob:0.9197 },
		{ level:"A", name:"布魯森薇拉單肩包", prob:0.9197 },
		{ level:"A", name:"小型寶石額頭裝飾(臉部裝飾欄位專用)", prob:1.0729 },
		{ level:"A", name:"蝙蝠怪盜假面(臉部裝飾欄位專用)", prob:1.0729 },
		{ level:"A", name:"保暖耳罩(臉部裝飾欄位專用)", prob:1.0729 },
		{ level:"A", name:"元素支配者頭部裝飾(臉部裝飾欄位專用)", prob:0.9197 },
		{ level:"A", name:"新月象徵暗月光環", prob:1.0729 },
		{ level:"A", name:"新月象徵紅月光環", prob:0.9197 },
		{ level:"A", name:"紅玉光均衡光環", prob:1.0729 },
	
		// B
		{ level:"B", name:"暗黑主教短版服裝(男性用)", prob:1.3795 },
		{ level:"B", name:"暗黑主教短版禮服(女性用)", prob:1.3795 },
		{ level:"B", name:"暗黑主教手套(男性用)", prob:1.5328 },
		{ level:"B", name:"暗黑主教手套(女性用)", prob:1.5328 },
		{ level:"B", name:"暗黑主教主教(男性用)", prob:1.5328 },
		{ level:"B", name:"暗黑主教主教(女性用)", prob:1.5328 },
		{ level:"B", name:"罪之尖刺光環", prob:1.5328 },
		{ level:"B", name:"惡魔之眼光環", prob:1.5328 },
		{ level:"B", name:"魔幻萬聖節法師服裝(男性用)", prob:1.5328 },
		{ level:"B", name:"魔幻萬聖節魔女服裝(女性用)", prob:1.5328 },
		{ level:"B", name:"魔幻萬聖節法師戒指(男性用)", prob:1.5328 },
		{ level:"B", name:"魔幻萬聖節魔女戒指(女性用)", prob:1.5328 },
		{ level:"B", name:"魔幻萬聖節魔女假髮(女性用)", prob:1.3795 },
		{ level:"B", name:"魔幻萬聖節法師假髮(男性用)", prob:1.3795 },
		{ level:"B", name:"魔幻萬聖節魔女假髮與帽子(女性用)", prob:1.3795 },
		{ level:"B", name:"魔幻萬聖節法師假髮與帽子(男性用)", prob:1.3795 },
		{ level:"B", name:"骷髏裝扮面具(臉部裝飾欄位專用)", prob:1.5328 },
		{ level:"B", name:"暗黑主教雙手劍外型卷軸", prob:1.5328 },
		{ level:"B", name:"夢幻的獨角獸騎槍外型卷軸", prob:1.5328 },
		{ level:"B", name:"萬聖節蜘蛛弓箭外型卷軸", prob:1.5328 },
		{ level:"B", name:"浪漫蕾絲時髦扇子外型卷軸", prob:1.5328 },
		{ level:"B", name:"齒輪羽毛耳朵裝飾(臉部裝飾欄位專用)", prob:1.5328 },
		{ level:"B", name:"黑玫瑰左側耳環與單片眼鏡(臉部裝飾欄位專用)", prob:1.5328 },
		{ level:"B", name:"性轉的幽闇眼罩(女性用)(臉部裝飾欄位專用)", prob:1.3795 },
		{ level:"B", name:"高貴的暗黑領主光環", prob:1.3795 },
		{ level:"B", name:"深淵的暗黑領主光環", prob:1.3795 },
	
		// C
		{ level:"C", name:"物理攻擊力增加藥水(30分鐘)", prob:1.5634 },
		{ level:"C", name:"魔法攻擊力增加藥水(2小時)", prob:1.5634 },
		{ level:"C", name:"魔法持續速度增加藥水(2小時)", prob:1.5634 },
		{ level:"C", name:"移動速度增加40%藥水(10分鐘)", prob:1.5634 },
		{ level:"C", name:"指定染色劑 #730000", prob:1.5634 },
		{ level:"C", name:"指定染色劑 #FF0000", prob:1.5634 },
		{ level:"C", name:"指定染色劑 #B6A0E4", prob:1.5634 },
		{ level:"C", name:"寵物指定顏色染劑 #000000", prob:1.5634 },
		{ level:"C", name:"寵物指定顏色染劑 #0000FF", prob:1.5634 },
		{ level:"C", name:"指定金屬染色劑(酸橙) #00FF00", prob:1.5634 },
		{ level:"C", name:"指定金屬染色劑(紫色) #800080", prob:1.5634 },
		{ level:"C", name:"拉近修練藥水", prob:1.5634 },
		{ level:"C", name:"黑闇轉換技能修練藥水", prob:1.5634 },
		{ level:"C", name:"幕前魁儡修練藥水", prob:1.5634 },
		{ level:"C", name:"十字槍擊修練藥水", prob:1.5634 },
		{ level:"C", name:"第六幕 : 誘惑的圈套修練藥水", prob:1.5634 },
		{ level:"C", name:"浪漫農場黑暗結界石柱", prob:1.5634 },
		{ level:"C", name:"浪漫農場萬聖節裝飾燭台", prob:1.5634 },
		{ level:"C", name:"浪漫農場萬聖節南瓜裝飾櫃", prob:1.5634 },
		{ level:"C", name:"浪漫農場萬聖節幽靈墓碑", prob:1.5634 },
		{ level:"C", name:"打噴嚏姿勢卡片", prob:1.5634 },
		{ level:"C", name:"瞄準姿勢卡片", prob:1.5634 },
		{ level:"C", name:"瑟瑟發抖姿勢卡片", prob:1.5634 }
	]
  },

  bunnyalice: {
    name: "萌兔愛麗絲箱子",
    price: DEFAULT_PRICE,
    rarities: ["S","A","B","C"],
    lsKey: "mabi_multi_bunnyalice_v1",
    pool: [
      { level:"S", name:"燦爛的萌兔愛麗絲紳士懷錶翅膀", prob:0.1013 },
      { level:"S", name:"敏捷的萌兔愛麗絲紳士懷錶翅膀", prob:0.1382 },
      { level:"S", name:"理想的萌兔愛麗絲紳士懷錶翅膀", prob:0.1382 },
      { level:"S", name:"感性的萌兔愛麗絲紳士懷錶翅膀", prob:0.1382 },
      { level:"S", name:"燦爛的萌兔愛麗絲懷錶翅膀", prob:0.1013 },
      { level:"S", name:"高潔的萌兔愛麗絲懷錶翅膀", prob:0.1382 },
      { level:"S", name:"精巧的萌兔愛麗絲懷錶翅膀", prob:0.1382 },
      { level:"S", name:"細緻的萌兔愛麗絲懷錶翅膀", prob:0.1382 },
      { level:"S", name:"特別萌兔愛麗絲服裝(男性用)", prob:0.0737 },
      { level:"S", name:"特別萌兔愛麗絲服裝(女性用)", prob:0.0737 },
      { level:"S", name:"萌兔愛麗絲服裝(男性用)", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲服裝(女性用)", prob:0.1228 },
      { level:"S", name:"特別萌兔愛麗絲紳士服裝(男性用)", prob:0.0737 },
      { level:"S", name:"特別萌兔愛麗絲少女服裝(女性用)", prob:0.0737 },
      { level:"S", name:"萌兔愛麗絲紳士服裝(男性用)", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲少女服裝(女性用)", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲紳士手套(男性用)", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲少女手套(女性用)", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲紳士短靴(男性用)", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲少女短靴(女性用)", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲帽", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲紳士帽", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲豎耳兔子光環", prob:0.1536 },
      { level:"S", name:"萌兔愛麗絲招風耳兔子光環", prob:0.1536 },
      { level:"S", name:"精靈形象變換藥水(夢幻的愛麗絲小兔子)", prob:0.1536 },
      { level:"S", name:"精靈形象變換藥水(夢幻的愛麗絲花紋小兔子)", prob:0.1536 },
      { level:"S", name:"精靈形象變換藥水(可愛的爆裂之星)", prob:0.1536 },
      { level:"S", name:"精靈形象變換藥水(清爽的爆裂之星)", prob:0.1536 },
      { level:"S", name:"精靈形象變換藥水(純真的爆裂之星)", prob:0.1536 },
      { level:"S", name:"精靈形象變換藥水(中毒爆裂之星)", prob:0.1536 },
      { level:"S", name:"移動投擲特效變更卡片(夢幻的愛麗絲小兔子)兌換券", prob:0.1228 },
      { level:"S", name:"活潑板特效變更卡片(粉色花朵圖案)兌換券", prob:0.1228 },
      { level:"S", name:"活潑板特效變更卡片(藍色花朵圖案)兌換券", prob:0.1228 },
      { level:"S", name:"活潑板特效變更卡片(純花色花屑) 兌換券", prob:0.1228 },
      { level:"S", name:"活潑板特效變更卡片(黑花花屑) 兌換券", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲魔杖外型卷軸", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲花紋魔杖外型卷軸", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲集魔杖外型卷軸", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲花紋集魔杖外型卷軸", prob:0.1228 },
      { level:"S", name:"萌兔愛麗絲卡片手裏劍外型卷軸", prob:0.1228 },
      { level:"S", name:"特別的星之神諭服裝(男性用)", prob:0.1013 },
      { level:"S", name:"特別的星之神諭服裝(女性用)", prob:0.1013 },
      { level:"S", name:"特別迷你龍族的可愛服裝(男性用)", prob:0.1228 },
      { level:"S", name:"特別迷你龍族的可愛洋裝(女性用)", prob:0.1228 },
      { level:"S", name:"特別迷你龍族的魅力服裝(男性用)", prob:0.1290 },
      { level:"S", name:"特別迷你龍族的魅力洋裝(女性用)", prob:0.1290 },

      { level:"A", name:"星之神諭服裝(男性用)", prob:0.3071 },
      { level:"A", name:"星之神諭服裝(女性用)", prob:0.3071 },
      { level:"A", name:"星之神諭手套(男性用)", prob:0.7678 },
      { level:"A", name:"星之神諭手環(女性用)", prob:0.7678 },
      { level:"A", name:"星之神諭鞋子(男性用)", prob:0.3071 },
      { level:"A", name:"星之神諭高跟鞋(女性用)", prob:0.3071 },
      { level:"A", name:"星之神諭頭飾", prob:0.3071 },
      { level:"A", name:"星之神諭眼罩(臉部裝飾欄位專用)", prob:0.9213 },
      { level:"A", name:"星之神諭光環", prob:1.0749 },
      { level:"A", name:"迷你龍族的可愛服裝(男性用)", prob:1.0749 },
      { level:"A", name:"迷你龍族的可愛洋裝(女性用)", prob:1.0749 },
      { level:"A", name:"迷你龍族的鞋子(男性用)", prob:0.3071 },
      { level:"A", name:"迷你龍族的鞋子(女性用)", prob:0.3071 },
      { level:"A", name:"甜點師工作服(男性用)", prob:0.7678 },
      { level:"A", name:"甜點師工作服(女性用)", prob:0.7678 },
      { level:"A", name:"古典長柄勺", prob:0.6142 },
      { level:"A", name:"古典餐刀", prob:0.6142 },
      { level:"A", name:"浪漫蕾絲時髦雨傘", prob:1.0749 },
      { level:"A", name:"浪漫蕾絲魅力扇子", prob:1.0749 },
      { level:"A", name:"古典女僕茶具組", prob:0.7678 },
      { level:"A", name:"邪惡兔兔髮夾(臉部裝飾欄位專用)", prob:1.0749 },
      { level:"A", name:"淘氣風臉部繃帶(臉部裝飾欄位專用)", prob:0.6142 },

      { level:"B", name:"迷你龍族的魅力服裝(男性用)", prob:1.3820 },
      { level:"B", name:"迷你龍族的魅力洋裝(女性用)", prob:1.3820 },
      { level:"B", name:"迷你龍族的假髮(男性用)", prob:1.2284 },
      { level:"B", name:"迷你龍族的假髮(女性用)", prob:1.2284 },
      { level:"B", name:"迷你龍族的手套(男性用)", prob:1.5355 },
      { level:"B", name:"迷你龍族的手套(女性用)", prob:1.5355 },
      { level:"B", name:"甜點師假髮(男性用)", prob:1.5355 },
      { level:"B", name:"甜點師帽子與假髮(男性用)", prob:1.5355 },
      { level:"B", name:"甜點師假髮(女性用)", prob:1.5355 },
      { level:"B", name:"甜點師帽子與假髮(女性用)", prob:1.5355 },
      { level:"B", name:"甜點師服裝(男性用)", prob:1.3820 },
      { level:"B", name:"甜點師服裝(女性用)", prob:1.3820 },
      { level:"B", name:"甜點師烤箱手套(男性用)", prob:1.5355 },
      { level:"B", name:"甜點師烤箱手套(女性用)", prob:1.5355 },
      { level:"B", name:"甜點師鞋子(男性用)", prob:1.5355 },
      { level:"B", name:"甜點師鞋子(女性用)", prob:1.5355 },
      { level:"B", name:"魅力的迷你龍族光環", prob:1.5355 },
      { level:"B", name:"美麗的迷你龍族光環", prob:1.2284 },
      { level:"B", name:"優雅的迷你龍族光環", prob:1.5355 },
      { level:"B", name:"高潔的迷你龍族光環", prob:1.5355 },
      { level:"B", name:"燦爛的迷你龍族光環", prob:1.5355 },
      { level:"B", name:"布魯森化妝豎琴", prob:1.5355 },
      { level:"B", name:"流浪劇團的曼陀林", prob:1.5355 },
      { level:"B", name:"閃耀鋼琴", prob:1.5355 },
      { level:"B", name:"佛羅倫斯沙發", prob:1.5355 },
      { level:"B", name:"熾天使祝福裝置", prob:1.5355 },
      { level:"B", name:"歌唱演奏指揮台", prob:1.5355 },

      { level:"C", name:"物理攻擊力增加藥水(30分鐘)", prob:1.5662 },
      { level:"C", name:"魔法攻擊力增加藥水(2小時)", prob:1.5662 },
      { level:"C", name:"魔法持續速度增加藥水(2小時)", prob:1.5662 },
      { level:"C", name:"移動速度增40%藥水", prob:1.5662 },
      { level:"C", name:"指定染色劑#39131A", prob:1.5662 },
      { level:"C", name:"指定染色劑#FFFFFF", prob:1.5662 },
      { level:"C", name:"指定染色劑#000000", prob:1.5662 },
      { level:"C", name:"寵物指定顏色染劑#fefefe", prob:1.5662 },
      { level:"C", name:"寵物指定顏色染劑#282828", prob:1.5662 },
      { level:"C", name:"指定金屬染色劑#282828", prob:1.5662 },
      { level:"C", name:"指定金屬染色劑#ffd700", prob:1.5662 },
      { level:"C", name:"魔法的染色八分音符(黃色)#FFFF00", prob:1.5662 },
      { level:"C", name:"魔法的染色八分音符(紫色)#8A2BE2", prob:1.5662 },
      { level:"C", name:"影子束縛修練藥水", prob:1.5662 },
      { level:"C", name:"吸取生命修練藥水", prob:1.5662 },
      { level:"C", name:"戰場的序曲修練藥水", prob:1.5662 },
      { level:"C", name:"旋風擺蓮腿修練藥水", prob:1.5662 },
      { level:"C", name:"爆裂術修練藥水", prob:1.5662 },
      { level:"C", name:"浪漫農場鬱金香拱門", prob:1.5662 },
      { level:"C", name:"浪漫農場鬱金香拱門與燈泡", prob:1.5662 },
      { level:"C", name:"浪漫農場鐘錶發條A", prob:1.5662 },
      { level:"C", name:"浪漫農場鐘錶發條B", prob:1.5662 },
      { level:"C", name:"歡迎光臨姿勢卡片", prob:1.5662 },
      { level:"C", name:"揶揄姿勢卡片", prob:1.5662 },
      { level:"C", name:"舉手應援姿勢卡片", prob:1.5662 }
    ]
  },
  
  beauty: {
    name: "美容造型箱子",
    price: DEFAULT_PRICE,          // 先沿用預設每抽 NT$25，可在畫面右上角改
    rarities: ["S","A","B","C"],
    lsKey: "mabi_multi_beauty_v1", // LocalStorage獨立key
    pool: [
      { level:"S", name:"天界貴族風格髮型美容兌換券(男性用)", prob:0.0501 },
      { level:"S", name:"天界貴族風格髮型美容兌換券(女性用)", prob:0.0501 },
      { level:"S", name:"日常風衣風格髮型美容兌換券(男性用)", prob:0.0592 },
      { level:"S", name:"日常風衣風格髮型美容兌換券(女性用)", prob:0.0592 },
      { level:"S", name:"害羞駭客風格髮型美容兌換券(男性用)", prob:0.0455 },
      { level:"S", name:"赤雲之隼風格髮型美容兌換券(女性用)", prob:0.0455 },
      { level:"S", name:"珠寶君主風格髮型美容兌換券(男性用)", prob:0.0688 },
      { level:"S", name:"浪漫蕾絲風格髮型美容兌換券(女性用)", prob:0.0688 },
      { level:"S", name:"番紅花高校風格髮型美容兌換券(男性用)", prob:0.0542 },
      { level:"S", name:"番紅花高校風格髮型美容兌換券(女性用)", prob:0.0542 },
      { level:"S", name:"半貓的眼睛(異色瞳)美容兌換券", prob:0.0198 },
      { level:"S", name:"魔女的眼睛(異色瞳)美容兌換券", prob:0.0228 },
      { level:"S", name:"為難的眼神(異色瞳)美容兌換券", prob:0.0251 },
      { level:"S", name:"飽含渴望的眼神(異色瞳)美容兌換券", prob:0.0273 },
      { level:"S", name:"月光之貓的眼睛(異色瞳)美容兌換券", prob:0.0296 },
      { level:"S", name:"不屑的眼神(異色瞳)美容兌換券", prob:0.0319 },
      { level:"S", name:"魔道的眼睛(異色瞳)美容兌換券", prob:0.0342 },
      { level:"S", name:"水滴眼神(異色瞳)美容兌換券", prob:0.0364 },
      { level:"S", name:"洗鍊的眼神(異色瞳)美容兌換券", prob:0.0387 },
      { level:"S", name:"失去靈魂的眼神(異色瞳)美容兌換券", prob:0.0410 },
      { level:"S", name:"仁慈的眼神(異色瞳)美容兌換券", prob:0.0433 },
      { level:"S", name:"充滿淘氣的眼神(異色瞳)美容兌換券", prob:0.0455 },
      { level:"S", name:"考古學家的眼睛(異色瞳)美容兌換券", prob:0.0478 },
      { level:"S", name:"教主的眼睛(異色瞳)美容兌換券", prob:0.0501 },
      { level:"S", name:"烏雲密布的眼神(異色瞳)美容兌換券", prob:0.0524 },
      { level:"S", name:"理解的眼神(異色瞳)美容兌換券", prob:0.0547 },
      { level:"S", name:"看見未來的眼睛(異色瞳)美容兌換券", prob:0.0569 },
      { level:"S", name:"超能力者的眼睛(異色瞳)美容兌換券", prob:0.0592 },
      { level:"S", name:"死亡的世界的眼神(異色瞳)美容兌換券", prob:0.0615 },
      { level:"S", name:"伯爵的眼睛(異色瞳)美容兌換券", prob:0.0638 },
      { level:"S", name:"貝羅拉中長髮型美容兌換券(男性用)", prob:0.0296 },
      { level:"S", name:"時髦貝羅拉中長髮型美容兌換券(男性用)", prob:0.0296 },
      { level:"S", name:"巫女的髮型美容兌換券(女性用)", prob:0.0296 },
      { level:"S", name:"可愛俏皮短髮髮型美容兌換券(女性用)", prob:0.0296 },
      { level:"S", name:"狂野日蝕長陰影髮型美容兌換券(男性用)", prob:0.0273 },
      { level:"S", name:"寂靜日蝕長陰影髮型美容兌換券(男性用)", prob:0.0273 },
      { level:"S", name:"迷霧利維安長直髮型美容兌換券(女性用)", prob:0.0273 },
      { level:"S", name:"蜜糖利維安長直髮型美容兌換券(女性用)", prob:0.0273 },
      { level:"S", name:"風暴莫霍克髮型美容兌換券(男性用)", prob:0.0198 },
      { level:"S", name:"布洛茜雙馬尾髮型美容兌換券(女性用)", prob:0.0198 },
      { level:"S", name:"遮眼辛蒂髮型美容兌換券(男性用)", prob:0.0251 },
      { level:"S", name:"新辛蒂長波浪髮型美容兌換券(女性用)", prob:0.0251 },
      { level:"S", name:"側分髮型美容兌換券(男性用)", prob:0.0148 },
      { level:"S", name:"艾夏長波浪髮型美容兌換券(女性用)", prob:0.0148 },
      { level:"S", name:"月之低語髮型美容兌換券(男性用)", prob:0.0173 },
      { level:"S", name:"飄逸層次剪髮型美容兌換券(男性用)", prob:0.0173 },
      { level:"S", name:"閃亮朱比雙馬尾髮型美容兌換券(女性用)", prob:0.0173 },
      { level:"S", name:"甜美朱比雙馬尾髮型美容兌換券(女性用)", prob:0.0173 },
      { level:"S", name:"浪漫賽莉絲長波浪髮型美容兌換券(女性用)", prob:0.0114 },
      { level:"S", name:"自然中分燙髮髮型美容兌換券(男性用)", prob:0.0205 },
      { level:"S", name:"花美男臉型美容兌換券(人類男性用)", prob:0.1571 },
      { level:"S", name:"優雅貴族臉型美容兌換券(人類女性用)", prob:0.1571 },
      { level:"S", name:"柔軟耳朵的瓜子臉型美容兌換券(精靈男性用)", prob:0.1571 },
      { level:"S", name:"小耳朵的瓜子臉型美容兌換券(精靈女性用)", prob:0.1571 },
      { level:"S", name:"浪漫臉型美容兌換券(巨人男性用)", prob:0.1571 },
      { level:"S", name:"娃娃臉型美容兌換券(巨人女性用)", prob:0.1571 },
      { level:"S", name:"白化的半貓的眼睛(異色瞳)美容兌換券", prob:0.0297 },
      { level:"S", name:"白化的魔女的眼睛(異色瞳)美容兌換券", prob:0.0319 },
      { level:"S", name:"白化的為難眼神(異色瞳)美容兌換券", prob:0.0342 },
      { level:"S", name:"白化的飽含渴望的眼神(異色瞳)美容兌換券", prob:0.0364 },
      { level:"S", name:"白化的月光之貓的眼睛(異色瞳)美容兌換券", prob:0.0387 },
      { level:"S", name:"白化的不屑眼神(異色瞳)美容兌換券", prob:0.0410 },
      { level:"S", name:"白化的魔道的眼睛(異色瞳)美容兌換券", prob:0.0433 },
      { level:"S", name:"白化的水滴眼神(異色瞳)美容兌換券", prob:0.0455 },
      { level:"S", name:"白化的洗鍊眼神(異色瞳)美容兌換券", prob:0.0478 },
      { level:"S", name:"白化的失去靈魂的眼神(異色瞳)美容兌換券", prob:0.0501 },
      { level:"S", name:"白化的仁慈眼神(異色瞳)美容兌換券", prob:0.0524 },
      { level:"S", name:"白化的充滿淘氣的眼神(異色瞳)美容兌換券", prob:0.0547 },
      { level:"S", name:"白化的考古學家的眼睛(異色瞳)美容兌換券", prob:0.0569 },
      { level:"S", name:"白化的教主的眼睛(異色瞳)美容兌換券", prob:0.0592 },
      { level:"S", name:"白化的烏雲密布眼神(異色瞳)美容兌換券", prob:0.0615 },
      { level:"S", name:"白化的理解眼神(異色瞳)美容兌換券", prob:0.1366 },
      { level:"S", name:"白化的看見未來的眼睛(異色瞳)美容兌換券", prob:0.2277 },
      { level:"S", name:"白化的超能力者的眼睛(異色瞳)美容兌換券", prob:0.2642 },
      { level:"S", name:"白化的死亡的世界的眼神(異色瞳)美容兌換券", prob:0.2778 },
      { level:"S", name:"白化的伯爵的眼睛(異色瞳)美容兌換券", prob:0.2824 },
      { level:"S", name:"魔女的嘴型美容兌換券", prob:0.2869 },
      { level:"S", name:"含笑的嘴型美容兌換券", prob:0.2869 },
      { level:"S", name:"可愛的臉頰鼓鼓嘴型美容兌換券", prob:0.2869 },
      { level:"S", name:"淘氣的嘴型美容兌換券", prob:0.2869 },
      { level:"S", name:"自然長髮髮型美容兌換券(女)", prob:0.0114 },
      { level:"S", name:"時尚的高馬尾髮型美容兌換券(女)", prob:0.0123 },
      { level:"S", name:"多層次捲髮髮型美容兌換券(女)", prob:0.0123 },
      { level:"S", name:"學院風魅力髮型美容兌換券(女)", prob:0.0123 },
      { level:"S", name:"冷靜的低馬尾長髮髮型美容兌換券(女)", prob:0.0123 },
      { level:"S", name:"小碎髮長髮髮型美容兌換券(女)", prob:0.0128 },
      { level:"S", name:"空氣瀏海長髮髮型美容兌換券(女)", prob:0.0132 },
      { level:"S", name:"可愛雙馬尾髮型美容兌換券(女)", prob:0.0159 },
      { level:"S", name:"校園風雙馬尾髮型美容兌換券(女)", prob:0.0182 },
      { level:"S", name:"聖誕祝福假髮髮型美容兌換券(女)", prob:0.0205 },
      { level:"S", name:"希瑞絲長波浪髮型美容兌換券(女)", prob:0.0205 },
      { level:"S", name:"蓬鬆短髮髮型美容兌換券(男)", prob:0.0228 },
      { level:"S", name:"王城魔法師波浪髮型美容兌換券(女)", prob:0.0228 },
      { level:"S", name:"護衛騎士髮型美容兌換券(女)", prob:0.0228 },
      { level:"S", name:"甜蜜美夢髮型美容兌換券(女)", prob:0.0251 },
      { level:"S", name:"深深凝視的眼神(大吉大利)美容兌換券", prob:0.0273 },
      { level:"S", name:"秋季勤奮髮型美容兌換券(男)", prob:0.0273 },
      { level:"S", name:"王城魔法師髮型美容兌換券(女)", prob:0.0296 },
      { level:"S", name:"黛伊爾布拉髮型美容兌換券(女)", prob:0.0296 },
      { level:"S", name:"野蠻自然旁分髮型美容兌換券(男)", prob:0.0296 },
      { level:"S", name:"中分長波浪髮型美容兌換券(男)", prob:0.0296 },
      { level:"S", name:"野蠻中分髮型美容兌換券(男)", prob:0.0296 },
      { level:"S", name:"海濱浴場髮型美容兌換券(女)", prob:0.0296 },
      { level:"S", name:"空氣燙髮型美容兌換券(男)", prob:0.0296 },
      { level:"S", name:"秘密別墅度假髮型美容兌換券(男)", prob:0.0319 },
      { level:"S", name:"稍微彆扭的嘴巴美容兌換券", prob:0.0319 },
      { level:"S", name:"波浪的守護者髮型美容兌換券(男)", prob:0.0319 },
      { level:"S", name:"月下的陰間使者髮型美容兌換券(女)", prob:0.0319 },
      { level:"S", name:"神獸守護者的髮型美容兌換券(女)", prob:0.0319 },
      { level:"S", name:"覆盆子雙辮子髮型美容兌換券(女)", prob:0.0342 },
      { level:"S", name:"戰場的軍人肩上短髮髮型美容兌換券(女)", prob:0.0342 },
      { level:"S", name:"夏季樂園髮型美容兌換券(女)", prob:0.0342 },
      { level:"S", name:"捲翹雙辮髮髮型美容兌換券(女)", prob:0.0342 },

      { level:"A", name:"布魯森化妝髮型美容兌換券(女)", prob:0.3097 },
      { level:"A", name:"雙馬尾大波浪捲髮髮型美容兌換券(女)", prob:0.3097 },
      { level:"A", name:"更新特拉克髮型美容兌換券(男)", prob:0.3097 },
      { level:"A", name:"秘密花園髮型美容兌換券(女)", prob:0.3097 },
      { level:"A", name:"元素支配者髮型美容兌換券(女)", prob:0.3188 },
      { level:"A", name:"露出虎牙的可愛嘴型美容兌換券", prob:0.3188 },
      { level:"A", name:"皮魯安髮型美容兌換券(女)", prob:0.3188 },
      { level:"A", name:"藍莓俏麗髮型美容兌換券(男)", prob:0.3188 },
      { level:"A", name:"魔王之眼(邪眼)美容兌換券", prob:0.3188 },
      { level:"A", name:"遮眼瀏海髮型美容兌換券(男)", prob:0.3188 },
      { level:"A", name:"魔法師的眼神(異色瞳)美容兌換券", prob:0.3188 },
      { level:"A", name:"自然旁分髮型美容兌換券(男)", prob:0.3188 },
      { level:"A", name:"妖魔之眼(束縛的目光)美容兌換券", prob:0.3644 },
      { level:"A", name:"興致勃勃的眼神(音符)美容兌換券", prob:0.3644 },
      { level:"A", name:"小耳朵發紅臉蛋美容兌換券(精靈女性)", prob:0.3644 },
      { level:"A", name:"俏麗可愛短髮髮型美容兌換券(女)", prob:0.3644 },
      { level:"A", name:"冬天羊毛特訓髮型美容兌換券(男)", prob:0.3644 },
      { level:"A", name:"誘惑的眼神(異色瞳)美容兌換券", prob:0.3644 },
      { level:"A", name:"白化的魔王之眼(異色瞳)美容兌換券", prob:0.3644 },
      { level:"A", name:"甜蜜學院髮型美容兌換券(女)", prob:0.3644 },
      { level:"A", name:"後梳油頭髮型美容兌換券(男)", prob:0.4099 },
      { level:"A", name:"滑順旁分燙髮型美容兌換券(男)", prob:0.4099 },
      { level:"A", name:"白化的清雅的眼神(海洋)美容兌換券", prob:0.4099 },
      { level:"A", name:"雙邊長馬尾髮型美容兌換券", prob:0.4099 },
      { level:"A", name:"自然包包頭髮型美容兌換券(女)", prob:0.4099 },
      { level:"A", name:"觀看世界的眼睛(異色瞳)美容兌換券", prob:0.4555 },
      { level:"A", name:"白化的先知者眼神(探照燈)美容兌換券", prob:0.4555 },
      { level:"A", name:"愛爾琳雜貨商髮型美容兌換券(男)", prob:0.4555 },
      { level:"A", name:"擔心的嘴型美容兌換券", prob:0.4555 },
      { level:"A", name:"暗黑主教髮型美容兌換券(男)", prob:0.4555 },
      { level:"A", name:"深深凝視的眼神(異色瞳)美容兌換券", prob:0.4555 },
      { level:"A", name:"可愛的下垂耳朵臉型美容兌換券(精靈女性用)", prob:0.4555 },
      { level:"A", name:"秘密森林髮型美容兌換券(男)", prob:0.4555 },
      { level:"A", name:"看起來幼小的愛心星星臉型美容兌換券(人類女性)", prob:0.4555 },
      { level:"A", name:"白化的閃爍的眼神(淡淡星光)美容兌換券", prob:0.4555 },
      { level:"A", name:"西洋棋皇后的髮型美容兌換券(女)", prob:0.4555 },
      { level:"A", name:"戰鬥型女僕髮型美容兌換券(女)", prob:0.5010 },
      { level:"A", name:"月下的陰間使者髮型美容兌換券(男)", prob:0.5010 },
      { level:"A", name:"充滿威嚴的眼神(啟示的目光)美容兌換券", prob:0.5010 },
      { level:"A", name:"充滿威嚴的眼神(異色瞳)美容兌換券", prob:0.5010 },
      { level:"A", name:"白化的興致勃勃的眼神(異色瞳)美容兌換券", prob:0.5010 },
      { level:"A", name:"日常中分瀏海髮型美容兌換券(男)", prob:0.5010 },
      { level:"A", name:"神獸守護者的髮型美容兌換券(男)", prob:0.5010 },
      { level:"A", name:"夏季樂園髮型美容兌換券(男)", prob:0.5466 },
      { level:"A", name:"經典木蘭花髮型美容兌換券(男)", prob:0.5466 },
      { level:"A", name:"艾莉娜新風格髮型美容兌換券(女)", prob:0.5466 },
      { level:"A", name:"高冷嘴型美容兌換券", prob:0.5466 },
      { level:"A", name:"拉格玲奈的臉型美容兌換券(人類女性用)", prob:0.5466 },
      { level:"A", name:"可愛的柔軟耳朵臉型美容兌換券(精靈男性用)", prob:0.5466 },
      { level:"A", name:"隱隱約約綻放的眼神(異色瞳)美容兌換券", prob:0.5466 },
      { level:"A", name:"明亮的眼神(異色瞳)美容兌換券", prob:0.5466 },
      { level:"A", name:"輕輕微笑的嘴巴美容兌換券", prob:0.5466 },

      { level:"B", name:"惡魔之眼(異色瞳)美容兌換券", prob:1.4802 },
      { level:"B", name:"可愛的泛潮紅臉型美容兌換券(男)", prob:1.4802 },
      { level:"B", name:"現代都會風髮型美容兌換券(男)", prob:1.4802 },
      { level:"B", name:"治癒的眼神(治療的祝福)美容兌換券", prob:1.4802 },
      { level:"B", name:"譏笑的嘴型美容兌換券", prob:1.4802 },
      { level:"B", name:"先知者的眼神(異色瞳)美容兌換券", prob:1.4802 },
      { level:"B", name:"小耳朵嘴下有小痣臉型美容兌換券(精靈女性)", prob:1.4802 },
      { level:"B", name:"可愛貼有ok繃臉龐美容兌換券(人類男性)", prob:1.4802 },
      { level:"B", name:"掠過陰沉的眼神美容兌換券", prob:1.4802 },
      { level:"B", name:"龍的眼睛(紅焰)美容兌換券", prob:1.4802 },
      { level:"B", name:"嘴角上揚嘴型美容兌換券", prob:1.4802 },
      { level:"B", name:"裝可愛的嘴型美容兌換券", prob:1.4802 },
      { level:"B", name:"挺鼻眼下有痣臉龐美容兌換券(人類女性)", prob:1.4802 },
      { level:"B", name:"白化的隱隱約約綻放的眼神(異色瞳)美容兌換券", prob:1.4802 },
      { level:"B", name:"燦爛的寶石眼神(異色瞳)美容兌換券", prob:1.4802 },
      { level:"B", name:"白化的燦爛寶石眼神(異色瞳)美容兌換券", prob:1.4802 },
      { level:"B", name:"尖瘦下顎線臉型美容兌換券(巨人女性用)", prob:1.4802 },
      { level:"B", name:"白化的閃爍的眼神(異色瞳)美容兌換券", prob:1.4802 },
      { level:"B", name:"尖瘦下顎線臉型美容兌換券(巨人男性用)", prob:1.4802 },
      { level:"B", name:"表情僵硬的嘴型美容兌換券", prob:1.4802 },
      { level:"B", name:"慈悲之神的眼睛(異色瞳)美容兌換券", prob:1.4802 },
      { level:"B", name:"櫻桃小嘴嘴型美容兌換券", prob:1.4802 },
      { level:"B", name:"凝重的眼神(光之氣息)美容兌換券", prob:1.4802 },
      { level:"B", name:"尖瘦臉型美容兌換券(女)", prob:1.4802 },
      { level:"B", name:"白化的龍的眼睛(異色瞳)美容兌換券", prob:1.4802 },

      { level:"C", name:"疲憊的眼神(異色瞳)美容兌換券", prob:1.7991 },
      { level:"C", name:"散發明亮光芒的眼神美容兌換券", prob:1.7991 },
      { level:"C", name:"勇士的眼神(異色瞳)美容兌換券", prob:1.7991 },
      { level:"C", name:"托爾維斯的眼睛(異色瞳)美容兌換券", prob:1.7991 },
      { level:"C", name:"眼底星空眼型美容兌換券", prob:1.7991 },
      { level:"C", name:"可愛的小漩渦臉型美容兌換券(人類男性)", prob:1.7991 },
      { level:"C", name:"白化的落下陰影的眼神(異色瞳)美容兌換券", prob:1.7991 },
      { level:"C", name:"小耳朵橢圓腮紅臉龐美容兌換券(精靈女性)", prob:1.7991 },
      { level:"C", name:"可愛肉肉臉型美容兌換券(女)", prob:1.7991 },
      { level:"C", name:"小耳朵鼻子OK繃臉型美容兌換券(精靈女性)", prob:1.7991 },
      { level:"C", name:"惡魔嘴型美容兌換券", prob:1.7991 },
      { level:"C", name:"可愛橢圓腮紅臉龐美容兌換券(人類男性)", prob:1.7991 },
      { level:"C", name:"洛維林的眼睛(異色瞳)美容兌換券", prob:1.7991 },
      { level:"C", name:"溫柔凝視的眼神(異色瞳)美容兌換券", prob:1.7991 },
      { level:"C", name:"垂耳泛潮紅臉型美容兌換券(男)", prob:1.7991 },
      { level:"C", name:"男子氣概少年的小漩渦臉型美容兌換券(人類男性)", prob:1.7991 },
      { level:"C", name:"垂耳眼下有痣臉龐美容兌換券(精靈男性)", prob:1.7991 },
      { level:"C", name:"可愛肉肉愛心星星臉型美容兌換券(人類女性)", prob:1.7991 },
      { level:"C", name:"嘴下有小痣臉型美容兌換券(巨人男性)", prob:1.7991 }
    ]
  }
};

/* 為每個 pool 建立穩定 id */
for (const mid of Object.keys(MACHINES)) {
  MACHINES[mid].pool.forEach((it, idx) => it.id = idx);
}

/* ===================== 全域狀態 ===================== */
let currentMid = "royal";
let mode = "normal"; // normal | eu | af
let multipliers = { S:1, A:1, B:1, C:1 };

const stateByMachine = {};
for (const mid of Object.keys(MACHINES)) {
  stateByMachine[mid] = loadState(mid);
}

function loadState(mid){
  const { lsKey, pool } = MACHINES[mid];
  // 歷史
  let history = [];
  try { const raw = localStorage.getItem(lsKey); if (raw) history = JSON.parse(raw); } catch{}
  // 單品價格表（每個項目 id -> 價格）
  let prices = {};
  try { const rawP = localStorage.getItem(lsKey + "_prices"); if (rawP) prices = JSON.parse(rawP) || {}; } catch{}
  // 每抽價格（各轉蛋獨立保存；預設用 MACHINES[mid].price 或 25）
  let pricePerDraw = MACHINES[mid].price ?? 25;
  try {
    const rawD = localStorage.getItem(lsKey + "_pricePerDraw");
    if (rawD !== null) pricePerDraw = Math.max(0, Number(rawD));
  } catch {}

  const tally = { S:0, A:0, B:0, C:0 };
  const itemCounts = new Array(pool.length).fill(0);
  for (const h of history) {
    if (typeof h.id === "number" && pool[h.id]) {
      tally[ pool[h.id].level ]++;
      itemCounts[h.id] += 1;
    }
  }
  return { history, tally, itemCounts, count: history.length, prices, pricePerDraw };
}
function saveState(mid){ localStorage.setItem(MACHINES[mid].lsKey, JSON.stringify(stateByMachine[mid].history)); }
function savePrices(mid){ localStorage.setItem(MACHINES[mid].lsKey + "_prices", JSON.stringify(stateByMachine[mid].prices)); }
function savePricePerDraw(mid){
  const { lsKey } = MACHINES[mid];
  const v = stateByMachine[mid].pricePerDraw ?? MACHINES[mid].price ?? 25;
  localStorage.setItem(lsKey + "_pricePerDraw", String(v));
}

/* ===================== 模式（BUFF/DEBUFF） ===================== */
function setMode(newMode){
  mode = newMode;
  if (mode === 'eu')      multipliers = { S:2,   A:1,    B:1,    C:1 };
  else if (mode === 'af') multipliers = { S:0.7, A:0.95, B:1.05, C:1.10 };
  else                    multipliers = { S:1,   A:1,    B:1,    C:1 };
  document.getElementById('mode').textContent =
    mode==='eu' ? '歐洲人 BUFF（S×2）' :
    mode==='af' ? '汪汪盤子（溫和 DEBUFF）' : '一般';
  document.getElementById('btn-eu').classList.toggle('active', mode==='eu');
  document.getElementById('btn-af').classList.toggle('active', mode==='af');
}
function toggleEU(){ setMode(mode==='eu'?'normal':'eu'); }
function toggleAF(){ setMode(mode==='af'?'normal':'af'); }

/* ===================== 加權抽取 ===================== */
function getRandomItem(pool){
  const weights = pool.map(it => it.prob * (multipliers[it.level] || 1));
  const total = weights.reduce((a,b)=>a+b, 0);
  const r = Math.random() * total;
  let sum = 0;
  for (let i=0;i<pool.length;i++){
    sum += weights[i];
    if (r <= sum) return pool[i];
  }
  return pool[pool.length-1];
}

/* ===================== 事件：抽卡 ===================== */
function draw(n){
  const machine = MACHINES[currentMid];
  const state = stateByMachine[currentMid];
  const latest = [];
  for (let i=0;i<n;i++){
    const item = getRandomItem(machine.pool);
    latest.push(item);
    state.history.push({ ts: Date.now(), id: item.id });
    state.tally[item.level]++; state.count += 1;
    state.itemCounts[item.id] = (state.itemCounts[item.id]||0)+1;
    updatePoolCountBadge(item.id);
  }
  saveState(currentMid);
  renderResult(latest);
  updateSummary();
  renderHistory();
  if (ui.drawnOnly || ui.sortByCount) renderPool();
}

/* ===================== 圖表 ===================== */
const ctx = document.getElementById('chart').getContext('2d');
const chart = new Chart(ctx,{
  type:'bar',
  data:{ labels:['S','A','B','C'], datasets:[{ label:'中獎次數', data:[0,0,0,0],
    backgroundColor:['#ef9a9a','#ffd166','#9ecbff','#d1d5db'] }]},
  options:{ responsive:true, scales:{ y:{ beginAtZero:true, precision:0 } } }
});
function syncChart(){
  const machine = MACHINES[currentMid];
  const state = stateByMachine[currentMid];
  const labs = machine.rarities.slice();
  const data = labs.map(lv => state.tally[lv]||0);
  chart.data.labels = labs;
  chart.data.datasets[0].data = data;
  chart.update();
}

/* ===================== Pool 清單（過濾/排序/搜尋 + 價格欄） ===================== */
const ui = { drawnOnly:false, sortByCount:false, sortByRarity:false, keyword:'' };
document.getElementById('toggle-drawn').addEventListener('change', e => { ui.drawnOnly=e.target.checked; renderPool(); });
document.getElementById('toggle-sort-count').addEventListener('change', e => { ui.sortByCount=e.target.checked; renderPool(); });
document.getElementById('toggle-sort-rarity').addEventListener('change', e => { ui.sortByRarity=e.target.checked; renderPool(); });
document.getElementById('search').addEventListener('input', e => { ui.keyword=e.target.value.trim(); renderPool(); });

// 代理監聽：價格輸入變更（單品價格）
document.getElementById('pool').addEventListener('input', (e) => {
  const el = e.target;
  if (!el.classList.contains('price-input')) return;
  const id = Number(el.dataset.id);
  const val = Number(el.value);
  const state = stateByMachine[currentMid];
  state.prices[id] = isFinite(val) && val >= 0 ? val : 0;
  savePrices(currentMid);
  updateSummary(); // 重新計算總價值、損益
});

function renderPool(){
  const { pool } = MACHINES[currentMid];
  const state = stateByMachine[currentMid];
  const wrap = document.getElementById('pool');

  const rows = pool.map(it => ({
    ...it,
    rarityRank: ({S:0,A:1,B:2,C:3})[it.level],
    count: state.itemCounts[it.id] || 0,
    price: state.prices[it.id] ?? 0
  }));
  let filtered = rows.filter(r => (!ui.drawnOnly || r.count>0) &&
                                  (!ui.keyword || r.name.includes(ui.keyword)));
  if (ui.sortByRarity) filtered.sort((a,b)=> a.rarityRank - b.rarityRank || b.count - a.count || a.id - b.id);
  else if (ui.sortByCount) filtered.sort((a,b)=> b.count - a.count || a.rarityRank - b.rarityRank || a.id - b.id);
  else filtered.sort((a,b)=> a.rarityRank - b.rarityRank || a.id - b.id);

  wrap.innerHTML = '';
  const container = document.createElement('div'); container.className='pool';
  filtered.forEach(it=>{
    const badgeCls='badge ' + (it.level==='S'?'lvS':it.level==='A'?'lvA':it.level==='B'?'lvB':'lvC');
    const cntCls  ='count ' + (it.level==='S'?'lvS':it.level==='A'?'lvA':it.level==='B'?'lvB':'lvC');
    const div=document.createElement('div'); div.className='pool-item';
    div.innerHTML = `
      <div class="pool-item-inner">
        <span class="${badgeCls}">${it.level}</span>
        <span class="name">${it.name}</span>
        <div class="right">
          <span class="${cntCls}" id="cnt-${it.id}">x${it.count}</span>
          <span class="muted">NT$</span>
          <input type="number" min="0" step="1" class="price-input" data-id="${it.id}" value="${it.price}">
        </div>
      </div>`;
    container.appendChild(div);
  });
  wrap.appendChild(container);
}
function updatePoolCountBadge(id){
  const el=document.getElementById(`cnt-${id}`);
  if (el) {
    const state = stateByMachine[currentMid];
    el.textContent = `x${state.itemCounts[id] || 0}`;
  }
}

/* ===================== 歷史/結果/統計 + 價值、損益 ===================== */
function computeTotalValue(mid){
  const machine = MACHINES[mid];
  const state = stateByMachine[mid];
  let total = 0;
  for (let i=0;i<machine.pool.length;i++){
    const price = Number(state.prices[i] ?? 0);
    const cnt = Number(state.itemCounts[i] ?? 0);
    if (price > 0 && cnt > 0) total += price * cnt;
  }
  return total;
}
function renderResult(items){
  const result = document.getElementById('result');
  const html = items.map(it=>{
    const lvCls=it.level==='S'?'lvS':it.level==='A'?'lvA':it.level==='B'?'lvB':'lvC';
    return `<div class="result-item"><span class="badge ${lvCls}">${it.level}</span> ${it.name}</div>`;
  }).join('');
  result.innerHTML = html;
}
function renderHistory(){
  const { pool } = MACHINES[currentMid];
  const { history } = stateByMachine[currentMid];
  const box = document.getElementById('history');
  if (!history.length){ box.innerHTML='<span class="muted">目前沒有歷史紀錄。</span>'; return; }
  const rows = history.slice().reverse().map(h=>{
    const p = pool[h.id]; const level=p?.level??'?'; const name=p?.name??'(未知項目)';
    const time=new Date(h.ts).toLocaleString();
    const lvCls=level==='S'?'lvS':level==='A'?'lvA':level==='B'?'lvB':'lvC';
    return `<div class="result-item"><span class="badge ${lvCls}">${level}</span> ${name} <span class="muted">— ${time}</span></div>`;
  }).join('');
  box.innerHTML = rows;
}
function updateSummary(){
  const machine = MACHINES[currentMid];
  const state = stateByMachine[currentMid];
  const price = state.pricePerDraw ?? machine.price ?? 25;

  document.getElementById('machine-name').textContent = machine.name;

  // 同步「每抽價格」輸入框
  const priceInput = document.getElementById('price-per-draw');
  if (document.activeElement !== priceInput) priceInput.value = String(price);

  document.getElementById('summary').textContent =
    `總共抽了 ${state.count} 次｜` + machine.rarities.map(lv => `${lv}: ${state.tally[lv]||0}`).join(', ');

  const total = state.count || 1;
  const rateText = machine.rarities.map(lv => `${(((state.tally[lv]||0)*100)/total).toFixed(2)}%`).join('｜');
  document.getElementById('rates').textContent = `實際出貨率（累積）：S/A/B/C → ${rateText}`;

  document.getElementById('total-draws').textContent = state.count;

  // 花費用自訂價格
  const cost = state.count * price;
  document.getElementById('total-cost').textContent  = cost.toLocaleString();

  // 價值與損益
  const value = computeTotalValue(currentMid);
  document.getElementById('total-value').textContent = value.toLocaleString();
  const profit = value - cost;
  document.getElementById('total-profit').textContent = profit.toLocaleString();

  syncChart();
}

/* ===================== CSV（UTF-8 BOM） ===================== */
function downloadCSV(){
  const machine = MACHINES[currentMid];
  const { history } = stateByMachine[currentMid];
  if (!history.length){ alert('目前沒有歷史紀錄'); return; }
  const header='machine_id,machine_name,timestamp,datetime,id,level,name\n';
  const lines = history.map(h=>{
    const dt = new Date(h.ts).toISOString();
    const p = machine.pool[h.id]; const id=h.id; const level=p?.level??''; const name=p?.name??'';
    const safeName='"'+String(name).replace(/"/g,'""')+'"';
    return `${currentMid},${machine.name},${h.ts},${dt},${id},${level},${safeName}`;
  }).join('\n');
  const BOM = '\uFEFF';
  const blob = new Blob([BOM, header, lines], { type:'text/csv;charset=utf-8;' });
  const url  = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download=`${currentMid}_history.csv`; a.click();
  URL.revokeObjectURL(url);
}

/* ===================== 清除紀錄 ===================== */
function clearHistory(){
  if (!confirm('確定要清除本機歷史紀錄（僅此轉蛋）？')) return;
  const machine = MACHINES[currentMid];
  const state = stateByMachine[currentMid];
  state.history = [];
  state.tally = {S:0,A:0,B:0,C:0};
  state.itemCounts = new Array(machine.pool.length).fill(0);
  state.count = 0;
  // 不清除 prices（保留你的估價）
  saveState(currentMid);
  renderPool(); renderHistory(); updateSummary();
}

/* ===================== 價格估算 ===================== */
function estimateCost(){
  const n = Math.max(1, Math.floor(Number(document.getElementById('calc-n').value||0)));
  const price = stateByMachine[currentMid].pricePerDraw ?? MACHINES[currentMid].price ?? 25;
  document.getElementById('calc-out').textContent = `→ 估算：抽 ${n} 次 ≈ NT$ ${(n*price).toLocaleString()}`;
}

/* ===================== 初始化＆切換 ===================== */
function mountMachineOptions(){
  const sel = document.getElementById('machine-select');
  sel.innerHTML = '';
  for (const mid of Object.keys(MACHINES)) {
    const opt = document.createElement('option');
    opt.value = mid; opt.textContent = MACHINES[mid].name;
    sel.appendChild(opt);
  }
  sel.value = currentMid;
  sel.addEventListener('change', () => switchMachine(sel.value));
}
function switchMachine(mid){
  currentMid = mid;
  // 清搜尋詞，以免殘留
  ui.keyword = ''; document.getElementById('search').value = '';
  renderPool(); renderHistory(); updateSummary();
  // 重新漆徽章數
  MACHINES[currentMid].pool.forEach(it => updatePoolCountBadge(it.id));
}
function init(){
  mountMachineOptions();
  setMode('normal');
  switchMachine(currentMid);

  // 綁定「每抽價格」輸入事件（各轉蛋獨立保存）
  const priceInput = document.getElementById('price-per-draw');
  priceInput.addEventListener('input', () => {
    const v = Math.max(0, Math.floor(Number(priceInput.value || 0)));
    stateByMachine[currentMid].pricePerDraw = v;
    savePricePerDraw(currentMid);
    updateSummary(); // 重新計算花費與損益
  });
}
init();
</script>
</body>
</html>
